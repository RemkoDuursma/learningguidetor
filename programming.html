<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 4 Functions, lists and loops | A Learning Guide to R: data, analytical, and programming skills.</title>
  <meta name="description" content="This book teaches introductory to intermediate skills in R." />
  <meta name="generator" content="bookdown 0.17 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 4 Functions, lists and loops | A Learning Guide to R: data, analytical, and programming skills." />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This book teaches introductory to intermediate skills in R." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 4 Functions, lists and loops | A Learning Guide to R: data, analytical, and programming skills." />
  
  <meta name="twitter:description" content="This book teaches introductory to intermediate skills in R." />
  

<meta name="author" content="Remko Duursma" />


<meta name="date" content="2020-11-09" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="dataskills2.html"/>
<link rel="next" href="webservices.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="css\style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">A Learning Guide to R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#aboutauthor"><i class="fa fa-check"></i>About the author</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>1</b> Beginner skills</a><ul>
<li class="chapter" data-level="1.1" data-path="intro.html"><a href="intro.html#installingr"><i class="fa fa-check"></i><b>1.1</b> Installing R and Rstudio</a><ul>
<li class="chapter" data-level="1.1.1" data-path="intro.html"><a href="intro.html#exampledata"><i class="fa fa-check"></i><b>1.1.1</b> Example data used throughout this book</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="intro.html"><a href="intro.html#basicops"><i class="fa fa-check"></i><b>1.2</b> Basic operations</a></li>
<li class="chapter" data-level="1.3" data-path="intro.html"><a href="intro.html#vectorintro"><i class="fa fa-check"></i><b>1.3</b> Working with vectors</a></li>
<li class="chapter" data-level="1.4" data-path="intro.html"><a href="intro.html#writing-code-in-a-script"><i class="fa fa-check"></i><b>1.4</b> Writing code in a script</a></li>
<li class="chapter" data-level="1.5" data-path="intro.html"><a href="intro.html#vectorized"><i class="fa fa-check"></i><b>1.5</b> Vectorized operations</a><ul>
<li class="chapter" data-level="1.5.1" data-path="intro.html"><a href="intro.html#multifunctions"><i class="fa fa-check"></i><b>1.5.1</b> Applying multiple functions at once</a></li>
</ul></li>
<li class="chapter" data-level="1.6" data-path="intro.html"><a href="intro.html#matrices"><i class="fa fa-check"></i><b>1.6</b> Working with matrices</a></li>
<li class="chapter" data-level="1.7" data-path="intro.html"><a href="intro.html#objects-in-the-workspace"><i class="fa fa-check"></i><b>1.7</b> Objects in the workspace</a></li>
<li class="chapter" data-level="1.8" data-path="intro.html"><a href="intro.html#fileswd"><i class="fa fa-check"></i><b>1.8</b> Files in the working directory</a></li>
<li class="chapter" data-level="1.9" data-path="intro.html"><a href="intro.html#rstudio-projects"><i class="fa fa-check"></i><b>1.9</b> Rstudio projects</a></li>
<li class="chapter" data-level="1.10" data-path="intro.html"><a href="intro.html#packages"><i class="fa fa-check"></i><b>1.10</b> Packages</a><ul>
<li class="chapter" data-level="1.10.1" data-path="intro.html"><a href="intro.html#installpackage"><i class="fa fa-check"></i><b>1.10.1</b> Install packages from CRAN</a></li>
<li class="chapter" data-level="1.10.2" data-path="intro.html"><a href="intro.html#loadpackage"><i class="fa fa-check"></i><b>1.10.2</b> Loading packages</a></li>
<li class="chapter" data-level="1.10.3" data-path="intro.html"><a href="intro.html#setting-the-cran-mirror"><i class="fa fa-check"></i><b>1.10.3</b> Setting the CRAN mirror</a></li>
<li class="chapter" data-level="1.10.4" data-path="intro.html"><a href="intro.html#install-from-git-hosting-sites"><i class="fa fa-check"></i><b>1.10.4</b> Install from git hosting sites</a></li>
<li class="chapter" data-level="1.10.5" data-path="intro.html"><a href="intro.html#updating-r-and-package-locations"><i class="fa fa-check"></i><b>1.10.5</b> Updating R and package locations</a></li>
<li class="chapter" data-level="1.10.6" data-path="intro.html"><a href="intro.html#updatingpackages"><i class="fa fa-check"></i><b>1.10.6</b> Updating packages</a></li>
<li class="chapter" data-level="1.10.7" data-path="intro.html"><a href="intro.html#install-missing-packages"><i class="fa fa-check"></i><b>1.10.7</b> Install missing packages</a></li>
<li class="chapter" data-level="1.10.8" data-path="intro.html"><a href="intro.html#conflicts"><i class="fa fa-check"></i><b>1.10.8</b> Conflicts</a></li>
<li class="chapter" data-level="1.10.9" data-path="intro.html"><a href="intro.html#pacman"><i class="fa fa-check"></i><b>1.10.9</b> Loading many packages</a></li>
</ul></li>
<li class="chapter" data-level="1.11" data-path="intro.html"><a href="intro.html#helpfiles"><i class="fa fa-check"></i><b>1.11</b> Accessing the help files</a></li>
<li class="chapter" data-level="1.12" data-path="intro.html"><a href="intro.html#writing-lots-of-code-rmarkdown-or-scripts"><i class="fa fa-check"></i><b>1.12</b> Writing lots of code: rmarkdown or scripts?</a><ul>
<li class="chapter" data-level="1.12.1" data-path="intro.html"><a href="intro.html#reproducible-documents-with-rmarkdown"><i class="fa fa-check"></i><b>1.12.1</b> Reproducible documents with rmarkdown</a></li>
<li class="chapter" data-level="1.12.2" data-path="intro.html"><a href="intro.html#scripts"><i class="fa fa-check"></i><b>1.12.2</b> Using R scripts</a></li>
</ul></li>
<li class="chapter" data-level="1.13" data-path="intro.html"><a href="intro.html#pay-attention-to-detail-write-clean-code"><i class="fa fa-check"></i><b>1.13</b> Pay attention to detail: write clean code</a></li>
<li class="chapter" data-level="1.14" data-path="intro.html"><a href="intro.html#exercises"><i class="fa fa-check"></i><b>1.14</b> Exercises</a><ul>
<li class="chapter" data-level="1.14.1" data-path="intro.html"><a href="intro.html#calculating"><i class="fa fa-check"></i><b>1.14.1</b> Calculating</a></li>
<li class="chapter" data-level="1.14.2" data-path="intro.html"><a href="intro.html#simple-objects"><i class="fa fa-check"></i><b>1.14.2</b> Simple objects</a></li>
<li class="chapter" data-level="1.14.3" data-path="intro.html"><a href="intro.html#vecexerc1"><i class="fa fa-check"></i><b>1.14.3</b> Working with a single vector</a></li>
<li class="chapter" data-level="1.14.4" data-path="intro.html"><a href="intro.html#scriptexercise"><i class="fa fa-check"></i><b>1.14.4</b> Scripts</a></li>
<li class="chapter" data-level="1.14.5" data-path="intro.html"><a href="intro.html#exquote"><i class="fa fa-check"></i><b>1.14.5</b> To quote or not to quote</a></li>
<li class="chapter" data-level="1.14.6" data-path="intro.html"><a href="intro.html#working-with-two-vectors"><i class="fa fa-check"></i><b>1.14.6</b> Working with two vectors</a></li>
<li class="chapter" data-level="1.14.7" data-path="intro.html"><a href="intro.html#alphabet-aerobics-1"><i class="fa fa-check"></i><b>1.14.7</b> Alphabet aerobics 1</a></li>
<li class="chapter" data-level="1.14.8" data-path="intro.html"><a href="intro.html#comparing-and-combining-vectors"><i class="fa fa-check"></i><b>1.14.8</b> Comparing and combining vectors</a></li>
<li class="chapter" data-level="1.14.9" data-path="intro.html"><a href="intro.html#into-the-matrix"><i class="fa fa-check"></i><b>1.14.9</b> Into the matrix</a></li>
<li class="chapter" data-level="1.14.10" data-path="intro.html"><a href="intro.html#packages-1"><i class="fa fa-check"></i><b>1.14.10</b> Packages</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="dataskills1.html"><a href="dataskills1.html"><i class="fa fa-check"></i><b>2</b> Data skills - Part 1</a><ul>
<li class="chapter" data-level="2.1" data-path="dataskills1.html"><a href="dataskills1.html#introduction"><i class="fa fa-check"></i><b>2.1</b> Introduction</a></li>
<li class="chapter" data-level="2.2" data-path="dataskills1.html"><a href="dataskills1.html#generating-data"><i class="fa fa-check"></i><b>2.2</b> Generating data</a><ul>
<li class="chapter" data-level="2.2.1" data-path="dataskills1.html"><a href="dataskills1.html#sequences"><i class="fa fa-check"></i><b>2.2.1</b> Sequences of numbers</a></li>
<li class="chapter" data-level="2.2.2" data-path="dataskills1.html"><a href="dataskills1.html#randomnumbers"><i class="fa fa-check"></i><b>2.2.2</b> Random numbers</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="dataskills1.html"><a href="dataskills1.html#readingdata"><i class="fa fa-check"></i><b>2.3</b> Reading data</a><ul>
<li class="chapter" data-level="2.3.1" data-path="dataskills1.html"><a href="dataskills1.html#readcsv"><i class="fa fa-check"></i><b>2.3.1</b> Reading CSV files</a></li>
<li class="chapter" data-level="2.3.2" data-path="dataskills1.html"><a href="dataskills1.html#reading-large-csv-files"><i class="fa fa-check"></i><b>2.3.2</b> Reading large CSV files</a></li>
<li class="chapter" data-level="2.3.3" data-path="dataskills1.html"><a href="dataskills1.html#tabdelimtext"><i class="fa fa-check"></i><b>2.3.3</b> Reading Tab-delimited text files</a></li>
<li class="chapter" data-level="2.3.4" data-path="dataskills1.html"><a href="dataskills1.html#datainscript"><i class="fa fa-check"></i><b>2.3.4</b> Including data in a script</a></li>
<li class="chapter" data-level="2.3.5" data-path="dataskills1.html"><a href="dataskills1.html#json"><i class="fa fa-check"></i><b>2.3.5</b> JSON</a></li>
<li class="chapter" data-level="2.3.6" data-path="dataskills1.html"><a href="dataskills1.html#nosql-databases"><i class="fa fa-check"></i><b>2.3.6</b> (No)SQL databases</a></li>
<li class="chapter" data-level="2.3.7" data-path="dataskills1.html"><a href="dataskills1.html#excel-spreadsheets"><i class="fa fa-check"></i><b>2.3.7</b> Excel spreadsheets</a></li>
<li class="chapter" data-level="2.3.8" data-path="dataskills1.html"><a href="dataskills1.html#proprietary-formats"><i class="fa fa-check"></i><b>2.3.8</b> Proprietary formats</a></li>
<li class="chapter" data-level="2.3.9" data-path="dataskills1.html"><a href="dataskills1.html#web-services"><i class="fa fa-check"></i><b>2.3.9</b> Web services</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="dataskills1.html"><a href="dataskills1.html#dataframes"><i class="fa fa-check"></i><b>2.4</b> Working with dataframes</a><ul>
<li class="chapter" data-level="2.4.1" data-path="dataskills1.html"><a href="dataskills1.html#vecstodfr"><i class="fa fa-check"></i><b>2.4.1</b> Convert vectors into a dataframe</a></li>
<li class="chapter" data-level="2.4.2" data-path="dataskills1.html"><a href="dataskills1.html#vecdataframes"><i class="fa fa-check"></i><b>2.4.2</b> Variables in the dataframe</a></li>
<li class="chapter" data-level="2.4.3" data-path="dataskills1.html"><a href="dataskills1.html#namesdataframe"><i class="fa fa-check"></i><b>2.4.3</b> Changing column names in dataframes</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="dataskills1.html"><a href="dataskills1.html#extracting-data"><i class="fa fa-check"></i><b>2.5</b> Extracting data</a><ul>
<li class="chapter" data-level="2.5.1" data-path="dataskills1.html"><a href="dataskills1.html#vectorindexing"><i class="fa fa-check"></i><b>2.5.1</b> Vectors</a></li>
<li class="chapter" data-level="2.5.2" data-path="dataskills1.html"><a href="dataskills1.html#subsetdataframes"><i class="fa fa-check"></i><b>2.5.2</b> Dataframes</a></li>
<li class="chapter" data-level="2.5.3" data-path="dataskills1.html"><a href="dataskills1.html#a-faster-method"><i class="fa fa-check"></i><b>2.5.3</b> A faster method</a></li>
<li class="chapter" data-level="2.5.4" data-path="dataskills1.html"><a href="dataskills1.html#deleting-columns"><i class="fa fa-check"></i><b>2.5.4</b> Deleting columns</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="dataskills1.html"><a href="dataskills1.html#exportingdata"><i class="fa fa-check"></i><b>2.6</b> Exporting data</a></li>
<li class="chapter" data-level="2.7" data-path="dataskills1.html"><a href="dataskills1.html#special-data-types"><i class="fa fa-check"></i><b>2.7</b> Special data types</a><ul>
<li class="chapter" data-level="2.7.1" data-path="dataskills1.html"><a href="dataskills1.html#workingfactors"><i class="fa fa-check"></i><b>2.7.1</b> Working with factors</a></li>
<li class="chapter" data-level="2.7.2" data-path="dataskills1.html"><a href="dataskills1.html#workinglogic"><i class="fa fa-check"></i><b>2.7.2</b> Working with logical data</a></li>
<li class="chapter" data-level="2.7.3" data-path="dataskills1.html"><a href="dataskills1.html#workingmissing"><i class="fa fa-check"></i><b>2.7.3</b> Working with missing values</a></li>
<li class="chapter" data-level="2.7.4" data-path="dataskills1.html"><a href="dataskills1.html#workingtext"><i class="fa fa-check"></i><b>2.7.4</b> Working with text</a></li>
<li class="chapter" data-level="2.7.5" data-path="dataskills1.html"><a href="dataskills1.html#workingwithdates"><i class="fa fa-check"></i><b>2.7.5</b> Working with dates and times</a></li>
<li class="chapter" data-level="2.7.6" data-path="dataskills1.html"><a href="dataskills1.html#converttype"><i class="fa fa-check"></i><b>2.7.6</b> Converting between data types</a></li>
</ul></li>
<li class="chapter" data-level="2.8" data-path="dataskills1.html"><a href="dataskills1.html#exercises-1"><i class="fa fa-check"></i><b>2.8</b> Exercises</a><ul>
<li class="chapter" data-level="2.8.1" data-path="dataskills1.html"><a href="dataskills1.html#working-with-a-single-vector---indexing"><i class="fa fa-check"></i><b>2.8.1</b> Working with a single vector - indexing</a></li>
<li class="chapter" data-level="2.8.2" data-path="dataskills1.html"><a href="dataskills1.html#alphabet-aerobics-2"><i class="fa fa-check"></i><b>2.8.2</b> Alphabet aerobics 2</a></li>
<li class="chapter" data-level="2.8.3" data-path="dataskills1.html"><a href="dataskills1.html#basic-operations-with-the-cereals-data"><i class="fa fa-check"></i><b>2.8.3</b> Basic operations with the Cereals data</a></li>
<li class="chapter" data-level="2.8.4" data-path="dataskills1.html"><a href="dataskills1.html#a-short-dataset"><i class="fa fa-check"></i><b>2.8.4</b> A short dataset</a></li>
<li class="chapter" data-level="2.8.5" data-path="dataskills1.html"><a href="dataskills1.html#titanic---part-1"><i class="fa fa-check"></i><b>2.8.5</b> Titanic - Part 1</a></li>
<li class="chapter" data-level="2.8.6" data-path="dataskills1.html"><a href="dataskills1.html#titanic---part-2"><i class="fa fa-check"></i><b>2.8.6</b> Titanic - Part 2</a></li>
<li class="chapter" data-level="2.8.7" data-path="dataskills1.html"><a href="dataskills1.html#hydro-dam"><i class="fa fa-check"></i><b>2.8.7</b> Hydro dam</a></li>
<li class="chapter" data-level="2.8.8" data-path="dataskills1.html"><a href="dataskills1.html#hfe-tree-measurements"><i class="fa fa-check"></i><b>2.8.8</b> HFE tree measurements</a></li>
<li class="chapter" data-level="2.8.9" data-path="dataskills1.html"><a href="dataskills1.html#flux-data"><i class="fa fa-check"></i><b>2.8.9</b> Flux data</a></li>
<li class="chapter" data-level="2.8.10" data-path="dataskills1.html"><a href="dataskills1.html#dna-aerobics"><i class="fa fa-check"></i><b>2.8.10</b> DNA Aerobics</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="dataskills2.html"><a href="dataskills2.html"><i class="fa fa-check"></i><b>3</b> Data skills - Part 2</a><ul>
<li class="chapter" data-level="3.1" data-path="dataskills2.html"><a href="dataskills2.html#summarizing-dataframes"><i class="fa fa-check"></i><b>3.1</b> Summarizing dataframes</a><ul>
<li class="chapter" data-level="3.1.1" data-path="dataskills2.html"><a href="dataskills2.html#tapplyaggregate"><i class="fa fa-check"></i><b>3.1.1</b> Making summary tables</a></li>
<li class="chapter" data-level="3.1.2" data-path="dataskills2.html"><a href="dataskills2.html#xtabs"><i class="fa fa-check"></i><b>3.1.2</b> Tables of counts</a></li>
<li class="chapter" data-level="3.1.3" data-path="dataskills2.html"><a href="dataskills2.html#summaryvars"><i class="fa fa-check"></i><b>3.1.3</b> Adding summary variables to dataframes</a></li>
<li class="chapter" data-level="3.1.4" data-path="dataskills2.html"><a href="dataskills2.html#reorder"><i class="fa fa-check"></i><b>3.1.4</b> Reordering factor levels based on a summary variable</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="dataskills2.html"><a href="dataskills2.html#combining-dataframes"><i class="fa fa-check"></i><b>3.2</b> Combining dataframes</a><ul>
<li class="chapter" data-level="3.2.1" data-path="dataskills2.html"><a href="dataskills2.html#merge"><i class="fa fa-check"></i><b>3.2.1</b> Merging dataframes</a></li>
<li class="chapter" data-level="3.2.2" data-path="dataskills2.html"><a href="dataskills2.html#dplyrjoin"><i class="fa fa-check"></i><b>3.2.2</b> Using join from <code>dplyr</code></a></li>
<li class="chapter" data-level="3.2.3" data-path="dataskills2.html"><a href="dataskills2.html#rbind"><i class="fa fa-check"></i><b>3.2.3</b> Row-binding dataframes</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="dataskills2.html"><a href="dataskills2.html#reshaping"><i class="fa fa-check"></i><b>3.3</b> Reshaping data</a><ul>
<li class="chapter" data-level="3.3.1" data-path="dataskills2.html"><a href="dataskills2.html#from-wide-to-long"><i class="fa fa-check"></i><b>3.3.1</b> From wide to long</a></li>
<li class="chapter" data-level="3.3.2" data-path="dataskills2.html"><a href="dataskills2.html#from-long-to-wide"><i class="fa fa-check"></i><b>3.3.2</b> From long to wide</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="dataskills2.html"><a href="dataskills2.html#more-complex-dplyr-examples"><i class="fa fa-check"></i><b>3.4</b> More complex <code>dplyr</code> examples</a><ul>
<li class="chapter" data-level="3.4.1" data-path="dataskills2.html"><a href="dataskills2.html#tree-growth-data-filter-and-multiple-groupings"><i class="fa fa-check"></i><b>3.4.1</b> Tree growth data: filter and multiple groupings</a></li>
<li class="chapter" data-level="3.4.2" data-path="dataskills2.html"><a href="dataskills2.html#crude-oil-production-find-top-exporters"><i class="fa fa-check"></i><b>3.4.2</b> Crude oil production: find top exporters</a></li>
<li class="chapter" data-level="3.4.3" data-path="dataskills2.html"><a href="dataskills2.html#weightlossdplyr"><i class="fa fa-check"></i><b>3.4.3</b> Weight loss data: make an irregular timeseries regular</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="dataskills2.html"><a href="dataskills2.html#exercises-2"><i class="fa fa-check"></i><b>3.5</b> Exercises</a><ul>
<li class="chapter" data-level="3.5.1" data-path="dataskills2.html"><a href="dataskills2.html#summarizing-the-cereal-data"><i class="fa fa-check"></i><b>3.5.1</b> Summarizing the cereal data</a></li>
<li class="chapter" data-level="3.5.2" data-path="dataskills2.html"><a href="dataskills2.html#words-and-the-weather"><i class="fa fa-check"></i><b>3.5.2</b> Words and the weather</a></li>
<li class="chapter" data-level="3.5.3" data-path="dataskills2.html"><a href="dataskills2.html#merging-data"><i class="fa fa-check"></i><b>3.5.3</b> Merging data</a></li>
<li class="chapter" data-level="3.5.4" data-path="dataskills2.html"><a href="dataskills2.html#merging-multiple-datasets"><i class="fa fa-check"></i><b>3.5.4</b> Merging multiple datasets</a></li>
<li class="chapter" data-level="3.5.5" data-path="dataskills2.html"><a href="dataskills2.html#ordered-boxplot"><i class="fa fa-check"></i><b>3.5.5</b> Ordered boxplot</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="programming.html"><a href="programming.html"><i class="fa fa-check"></i><b>4</b> Functions, lists and loops</a><ul>
<li class="chapter" data-level="4.1" data-path="programming.html"><a href="programming.html#introduction-1"><i class="fa fa-check"></i><b>4.1</b> Introduction</a></li>
<li class="chapter" data-level="4.2" data-path="programming.html"><a href="programming.html#writefunctions"><i class="fa fa-check"></i><b>4.2</b> Writing functions</a><ul>
<li class="chapter" data-level="4.2.1" data-path="programming.html"><a href="programming.html#returning-results"><i class="fa fa-check"></i><b>4.2.1</b> Returning results</a></li>
<li class="chapter" data-level="4.2.2" data-path="programming.html"><a href="programming.html#functions-without-arguments"><i class="fa fa-check"></i><b>4.2.2</b> Functions without arguments</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="programming.html"><a href="programming.html#workinglists"><i class="fa fa-check"></i><b>4.3</b> Working with lists</a><ul>
<li class="chapter" data-level="4.3.1" data-path="programming.html"><a href="programming.html#indexing-lists"><i class="fa fa-check"></i><b>4.3.1</b> Indexing lists</a></li>
<li class="chapter" data-level="4.3.2" data-path="programming.html"><a href="programming.html#converting-lists-to-dataframes-or-vectors"><i class="fa fa-check"></i><b>4.3.2</b> Converting lists to dataframes or vectors</a></li>
<li class="chapter" data-level="4.3.3" data-path="programming.html"><a href="programming.html#combining-lists"><i class="fa fa-check"></i><b>4.3.3</b> Combining lists</a></li>
<li class="chapter" data-level="4.3.4" data-path="programming.html"><a href="programming.html#extracting-output-from-built-in-functions"><i class="fa fa-check"></i><b>4.3.4</b> Extracting output from built-in functions</a></li>
<li class="chapter" data-level="4.3.5" data-path="programming.html"><a href="programming.html#dfrlists"><i class="fa fa-check"></i><b>4.3.5</b> Creating lists from dataframes</a></li>
<li class="chapter" data-level="4.3.6" data-path="programming.html"><a href="programming.html#lapply"><i class="fa fa-check"></i><b>4.3.6</b> Applying functions to lists</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="programming.html"><a href="programming.html#simpleloops"><i class="fa fa-check"></i><b>4.4</b> Loops</a><ul>
<li class="chapter" data-level="4.4.1" data-path="programming.html"><a href="programming.html#better-indexing"><i class="fa fa-check"></i><b>4.4.1</b> Better indexing</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="programming.html"><a href="programming.html#functionsadvanced"><i class="fa fa-check"></i><b>4.5</b> Functions : advanced concepts</a><ul>
<li class="chapter" data-level="4.5.1" data-path="programming.html"><a href="programming.html#why-should-i-write-more-functions"><i class="fa fa-check"></i><b>4.5.1</b> Why should I write more functions?</a></li>
<li class="chapter" data-level="4.5.2" data-path="programming.html"><a href="programming.html#wrapfunctions"><i class="fa fa-check"></i><b>4.5.2</b> Wrapper functions</a></li>
<li class="chapter" data-level="4.5.3" data-path="programming.html"><a href="programming.html#wrapper-functions-to-ggplot2-or-dplyr"><i class="fa fa-check"></i><b>4.5.3</b> Wrapper functions to <code>ggplot2</code> or <code>dplyr</code></a></li>
<li class="chapter" data-level="4.5.4" data-path="programming.html"><a href="programming.html#functions-that-take-vectors-as-input"><i class="fa fa-check"></i><b>4.5.4</b> Functions that take vectors as input</a></li>
<li class="chapter" data-level="4.5.5" data-path="programming.html"><a href="programming.html#if-then-else-switch"><i class="fa fa-check"></i><b>4.5.5</b> If, then, else … switch</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="programming.html"><a href="programming.html#defensive"><i class="fa fa-check"></i><b>4.6</b> Robust functions: defensive programming</a><ul>
<li class="chapter" data-level="4.6.1" data-path="programming.html"><a href="programming.html#argument-matching"><i class="fa fa-check"></i><b>4.6.1</b> Argument matching</a></li>
<li class="chapter" data-level="4.6.2" data-path="programming.html"><a href="programming.html#argument-checking"><i class="fa fa-check"></i><b>4.6.2</b> Argument checking</a></li>
<li class="chapter" data-level="4.6.3" data-path="programming.html"><a href="programming.html#sending-warnings-errors-messages"><i class="fa fa-check"></i><b>4.6.3</b> Sending warnings, errors, messages</a></li>
<li class="chapter" data-level="4.6.4" data-path="programming.html"><a href="programming.html#onexit"><i class="fa fa-check"></i><b>4.6.4</b> Executing code when the function ends (or fails)</a></li>
<li class="chapter" data-level="4.6.5" data-path="programming.html"><a href="programming.html#try"><i class="fa fa-check"></i><b>4.6.5</b> Catch errors with <code>try</code></a></li>
<li class="chapter" data-level="4.6.6" data-path="programming.html"><a href="programming.html#dbiwrappers"><i class="fa fa-check"></i><b>4.6.6</b> Writing database wrapper functions</a></li>
</ul></li>
<li class="chapter" data-level="4.7" data-path="programming.html"><a href="programming.html#exercises-3"><i class="fa fa-check"></i><b>4.7</b> Exercises</a><ul>
<li class="chapter" data-level="4.7.1" data-path="programming.html"><a href="programming.html#writing-functions"><i class="fa fa-check"></i><b>4.7.1</b> Writing functions</a></li>
<li class="chapter" data-level="4.7.2" data-path="programming.html"><a href="programming.html#working-with-lists"><i class="fa fa-check"></i><b>4.7.2</b> Working with lists</a></li>
<li class="chapter" data-level="4.7.3" data-path="programming.html"><a href="programming.html#functions-for-histograms"><i class="fa fa-check"></i><b>4.7.3</b> Functions for histograms</a></li>
<li class="chapter" data-level="4.7.4" data-path="programming.html"><a href="programming.html#using-functions-to-make-many-plots"><i class="fa fa-check"></i><b>4.7.4</b> Using functions to make many plots</a></li>
<li class="chapter" data-level="4.7.5" data-path="programming.html"><a href="programming.html#monthly-weather-plots"><i class="fa fa-check"></i><b>4.7.5</b> Monthly weather plots</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="webservices.html"><a href="webservices.html"><i class="fa fa-check"></i><b>5</b> R on the web</a><ul>
<li class="chapter" data-level="5.1" data-path="webservices.html"><a href="webservices.html#introduction-2"><i class="fa fa-check"></i><b>5.1</b> Introduction</a></li>
<li class="chapter" data-level="5.2" data-path="webservices.html"><a href="webservices.html#reading-data-from-remote-databases"><i class="fa fa-check"></i><b>5.2</b> Reading data from remote databases</a><ul>
<li class="chapter" data-level="5.2.1" data-path="webservices.html"><a href="webservices.html#dbi"><i class="fa fa-check"></i><b>5.2.1</b> Accessing databases with the DBI package</a></li>
<li class="chapter" data-level="5.2.2" data-path="webservices.html"><a href="webservices.html#nosql"><i class="fa fa-check"></i><b>5.2.2</b> NoSQL</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="webservices.html"><a href="webservices.html#accessing-an-api"><i class="fa fa-check"></i><b>5.3</b> Accessing an API</a></li>
<li class="chapter" data-level="5.4" data-path="webservices.html"><a href="webservices.html#deploying-an-api-with-plumber"><i class="fa fa-check"></i><b>5.4</b> Deploying an API with <code>plumber</code></a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="versioncontrol.html"><a href="versioncontrol.html"><i class="fa fa-check"></i><b>6</b> Version control with git</a><ul>
<li class="chapter" data-level="6.1" data-path="versioncontrol.html"><a href="versioncontrol.html#shouldigit"><i class="fa fa-check"></i><b>6.1</b> Should I learn version control?</a></li>
<li class="chapter" data-level="6.2" data-path="versioncontrol.html"><a href="versioncontrol.html#basics-of-git"><i class="fa fa-check"></i><b>6.2</b> Basics of git</a><ul>
<li class="chapter" data-level="6.2.1" data-path="versioncontrol.html"><a href="versioncontrol.html#basic-principles"><i class="fa fa-check"></i><b>6.2.1</b> Basic principles</a></li>
<li class="chapter" data-level="6.2.2" data-path="versioncontrol.html"><a href="versioncontrol.html#installing-git"><i class="fa fa-check"></i><b>6.2.2</b> Installing git</a></li>
<li class="chapter" data-level="6.2.3" data-path="versioncontrol.html"><a href="versioncontrol.html#using-git-in-rstudio"><i class="fa fa-check"></i><b>6.2.3</b> Using git in Rstudio</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="versioncontrol.html"><a href="versioncontrol.html#localgit"><i class="fa fa-check"></i><b>6.3</b> Local git repositories</a><ul>
<li class="chapter" data-level="6.3.1" data-path="versioncontrol.html"><a href="versioncontrol.html#firstgitsession"><i class="fa fa-check"></i><b>6.3.1</b> A first session with version control in Rstudio</a></li>
<li class="chapter" data-level="6.3.2" data-path="versioncontrol.html"><a href="versioncontrol.html#deleting-files-and-sensitive-information"><i class="fa fa-check"></i><b>6.3.2</b> Deleting files and sensitive information</a></li>
<li class="chapter" data-level="6.3.3" data-path="versioncontrol.html"><a href="versioncontrol.html#reverting-changes"><i class="fa fa-check"></i><b>6.3.3</b> Reverting changes</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="versioncontrol.html"><a href="versioncontrol.html#remotegit"><i class="fa fa-check"></i><b>6.4</b> Remote git repositories</a><ul>
<li class="chapter" data-level="6.4.1" data-path="versioncontrol.html"><a href="versioncontrol.html#makeremotegit"><i class="fa fa-check"></i><b>6.4.1</b> Making a remote repository</a></li>
<li class="chapter" data-level="6.4.2" data-path="versioncontrol.html"><a href="versioncontrol.html#gitremoteworkflow"><i class="fa fa-check"></i><b>6.4.2</b> Workflow</a></li>
<li class="chapter" data-level="6.4.3" data-path="versioncontrol.html"><a href="versioncontrol.html#a-session-with-a-remote-repository"><i class="fa fa-check"></i><b>6.4.3</b> A session with a remote repository</a></li>
<li class="chapter" data-level="6.4.4" data-path="versioncontrol.html"><a href="versioncontrol.html#conflicts-when-collaborating"><i class="fa fa-check"></i><b>6.4.4</b> Conflicts when collaborating</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="versioncontrol.html"><a href="versioncontrol.html#gitignore"><i class="fa fa-check"></i><b>6.5</b> Ignoring files</a></li>
<li class="chapter" data-level="6.6" data-path="versioncontrol.html"><a href="versioncontrol.html#commandline"><i class="fa fa-check"></i><b>6.6</b> Using the command line</a><ul>
<li class="chapter" data-level="6.6.1" data-path="versioncontrol.html"><a href="versioncontrol.html#basic-commands"><i class="fa fa-check"></i><b>6.6.1</b> Basic commands</a></li>
<li class="chapter" data-level="6.6.2" data-path="versioncontrol.html"><a href="versioncontrol.html#useful-tasks"><i class="fa fa-check"></i><b>6.6.2</b> Useful tasks</a></li>
</ul></li>
<li class="chapter" data-level="6.7" data-path="versioncontrol.html"><a href="versioncontrol.html#branches"><i class="fa fa-check"></i><b>6.7</b> Branches</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="projectman.html"><a href="projectman.html"><i class="fa fa-check"></i><b>7</b> Project management and workflow</a><ul>
<li class="chapter" data-level="7.1" data-path="projectman.html"><a href="projectman.html#tips-on-organizing-your-code"><i class="fa fa-check"></i><b>7.1</b> Tips on organizing your code</a></li>
<li class="chapter" data-level="7.2" data-path="projectman.html"><a href="projectman.html#rstudioprojects"><i class="fa fa-check"></i><b>7.2</b> Set up a project in Rstudio</a></li>
<li class="chapter" data-level="7.3" data-path="projectman.html"><a href="projectman.html#directory-structure"><i class="fa fa-check"></i><b>7.3</b> Directory structure</a><ul>
<li class="chapter" data-level="7.3.1" data-path="projectman.html"><a href="projectman.html#rawdata"><i class="fa fa-check"></i><b>7.3.1</b> <code>rawdata</code></a></li>
<li class="chapter" data-level="7.3.2" data-path="projectman.html"><a href="projectman.html#rfunctions"><i class="fa fa-check"></i><b>7.3.2</b> <code>Rfunctions</code></a></li>
<li class="chapter" data-level="7.3.3" data-path="projectman.html"><a href="projectman.html#output"><i class="fa fa-check"></i><b>7.3.3</b> <code>output</code></a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="projectman.html"><a href="projectman.html#the-r-scripts"><i class="fa fa-check"></i><b>7.4</b> The R scripts</a><ul>
<li class="chapter" data-level="7.4.1" data-path="projectman.html"><a href="projectman.html#facesoil_analysis.r"><i class="fa fa-check"></i><b>7.4.1</b> <code>facesoil_analysis.R</code></a></li>
<li class="chapter" data-level="7.4.2" data-path="projectman.html"><a href="projectman.html#facesoil_figures.r"><i class="fa fa-check"></i><b>7.4.2</b> <code>facesoil_figures.R</code></a></li>
<li class="chapter" data-level="7.4.3" data-path="projectman.html"><a href="projectman.html#facesoil_load"><i class="fa fa-check"></i><b>7.4.3</b> <code>facesoil_load</code></a></li>
<li class="chapter" data-level="7.4.4" data-path="projectman.html"><a href="projectman.html#load_packages.r"><i class="fa fa-check"></i><b>7.4.4</b> <code>load_packages.R</code></a></li>
<li class="chapter" data-level="7.4.5" data-path="projectman.html"><a href="projectman.html#facesoil_readdata.r"><i class="fa fa-check"></i><b>7.4.5</b> <code>facesoil_readdata.R</code></a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="projectman.html"><a href="projectman.html#archiving-the-output"><i class="fa fa-check"></i><b>7.5</b> Archiving the output</a><ul>
<li class="chapter" data-level="7.5.1" data-path="projectman.html"><a href="projectman.html#adding-a-date-stamp-to-output-files"><i class="fa fa-check"></i><b>7.5.1</b> Adding a Date stamp to output files</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="projectman.html"><a href="projectman.html#scriptstructure"><i class="fa fa-check"></i><b>7.6</b> A logical structure for your scripts</a><ul>
<li class="chapter" data-level="7.6.1" data-path="projectman.html"><a href="projectman.html#write-functions-not-long-scripts"><i class="fa fa-check"></i><b>7.6.1</b> Write functions, not long scripts</a></li>
<li class="chapter" data-level="7.6.2" data-path="projectman.html"><a href="projectman.html#divide-your-script-into-functional-blocks"><i class="fa fa-check"></i><b>7.6.2</b> Divide your script into functional blocks</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="masteringpackages.html"><a href="masteringpackages.html"><i class="fa fa-check"></i><b>8</b> Mastering package dependencies</a><ul>
<li class="chapter" data-level="8.1" data-path="masteringpackages.html"><a href="masteringpackages.html#what-version"><i class="fa fa-check"></i><b>8.1</b> What version?</a></li>
<li class="chapter" data-level="8.2" data-path="masteringpackages.html"><a href="masteringpackages.html#all-packages-loaded-or-installed"><i class="fa fa-check"></i><b>8.2</b> All packages: loaded or installed</a></li>
<li class="chapter" data-level="8.3" data-path="masteringpackages.html"><a href="masteringpackages.html#avoidconflicts"><i class="fa fa-check"></i><b>8.3</b> Avoiding conflicts</a></li>
<li class="chapter" data-level="8.4" data-path="masteringpackages.html"><a href="masteringpackages.html#searchpath"><i class="fa fa-check"></i><b>8.4</b> The search path and conflicts</a></li>
<li class="chapter" data-level="8.5" data-path="masteringpackages.html"><a href="masteringpackages.html#bundling-package-dependencies-with-renv"><i class="fa fa-check"></i><b>8.5</b> Bundling package dependencies with <code>renv</code></a></li>
<li class="chapter" data-level="8.6" data-path="masteringpackages.html"><a href="masteringpackages.html#minimizing-package-dependencies"><i class="fa fa-check"></i><b>8.6</b> Minimizing package dependencies</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">A Learning Guide to R: data, analytical, and programming skills.</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="programming" class="section level1">
<h1><span class="header-section-number">Chapter 4</span> Functions, lists and loops</h1>
<div id="introduction-1" class="section level2">
<h2><span class="header-section-number">4.1</span> Introduction</h2>
<p>This chapter demonstrates some building blocks of programming with R. The objective is to learn skills that help you with batch analyses - repeating similar tasks for many subsets of data, and to write functions to help you organize your code.</p>
<p>For batch analyses, we first have to know how to write our own functions (Section <a href="programming.html#writefunctions">4.2</a>), so that we can apply the custom function to any new subset of data. This approach results in far less, and much more readable code than copy-pasting similar code for different datasets.</p>
<p>We also delve into “lists” in R (Section <a href="programming.html#workinglists">4.3</a>), a versatile data object that you have worked with already - even if you didn’t know it. Understanding lists well in R is the key to more complex analyses, and more readable workflows.</p>
<p>We also take a brief look at ‘for loops’ (Section <a href="programming.html#simpleloops">4.4</a>), a basic programming utility that we rarely need in R, since almost all functions are vectorized. Sometimes it is however more convenient to use loops, or makes the code just a little more easy to work with.</p>
<p>Finally we introduce many more advanced concepts for writing functions (Section <a href="programming.html#functionsadvanced">4.5</a> and <a href="programming.html#defensive">4.6</a>), often to make functions more versatile and less error-prone.</p>
<p><strong>Packages used in this chapter</strong></p>
<p>We use no new packages in this chapter except the <code>wrapr</code> package. All other functionality is included in base R, or commonly used packages <code>dplyr</code>, <code>ggplot2</code>, <code>lubridate</code>, and <code>lgrdata</code> for the example data.</p>
</div>
<div id="writefunctions" class="section level2">
<h2><span class="header-section-number">4.2</span> Writing functions</h2>
<p>We have already used many built-in functions throughout this tutorial, but you can become very efficient at complex data tasks when you write your own simple functions. Writing your own functions can help with tasks that are carried out many times, which would otherwise result in a lot of code.</p>
<p>For example, suppose you frequently convert units from pounds to kilograms. It would be useful to have a function that does this, so you don’t have to type the conversion factor every time. This is also good practice, as it reduces the probability of making typos.</p>
<div class="sourceCode" id="cb551"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb551-1"><a href="programming.html#cb551-1"></a><span class="co"># This function takes a &#39;weight&#39; argument and multiplies it with some number </span></span>
<span id="cb551-2"><a href="programming.html#cb551-2"></a><span class="co"># to return kilograms.</span></span>
<span id="cb551-3"><a href="programming.html#cb551-3"></a>poundsToKg &lt;-<span class="st"> </span><span class="cf">function</span>(weight){</span>
<span id="cb551-4"><a href="programming.html#cb551-4"></a>  weight <span class="op">*</span><span class="st"> </span><span class="fl">0.453592</span></span>
<span id="cb551-5"><a href="programming.html#cb551-5"></a>}</span></code></pre></div>
<p>We can use this <code>function</code> just like any other in R, for example, let’s convert ‘weight’ to kilograms in the weightloss data.</p>
<div class="sourceCode" id="cb552"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb552-1"><a href="programming.html#cb552-1"></a><span class="co"># Read data</span></span>
<span id="cb552-2"><a href="programming.html#cb552-2"></a><span class="kw">library</span>(lgrdata)</span>
<span id="cb552-3"><a href="programming.html#cb552-3"></a><span class="kw">data</span>(weightloss)</span>
<span id="cb552-4"><a href="programming.html#cb552-4"></a></span>
<span id="cb552-5"><a href="programming.html#cb552-5"></a><span class="co"># Convert weight to kg.</span></span>
<span id="cb552-6"><a href="programming.html#cb552-6"></a>weightloss<span class="op">$</span>Weight &lt;-<span class="st"> </span><span class="kw">poundsToKg</span>(weightloss<span class="op">$</span>Weight)</span></code></pre></div>
<p>Let’s write a function for the standard error of the mean, a function that is not built-in in R.</p>
<div class="sourceCode" id="cb553"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb553-1"><a href="programming.html#cb553-1"></a><span class="co"># Compute the standard error of the mean for a vector</span></span>
<span id="cb553-2"><a href="programming.html#cb553-2"></a>SEmean &lt;-<span class="st"> </span><span class="cf">function</span>(x){</span>
<span id="cb553-3"><a href="programming.html#cb553-3"></a>  se &lt;-<span class="st"> </span><span class="kw">sd</span>(x) <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(<span class="kw">length</span>(x))</span>
<span id="cb553-4"><a href="programming.html#cb553-4"></a>  <span class="kw">return</span>(se)</span>
<span id="cb553-5"><a href="programming.html#cb553-5"></a>}</span></code></pre></div>
<p>Here, the <code>function</code> SEmean takes one ‘argument’ called <code>x</code> (i.e., input), which is a numeric vector. The standard error for the mean is calculated in the first line, and stored in an object called <code>se</code>, which is then returned as output. We can now use the function on a numeric vector like this:</p>
<div class="sourceCode" id="cb554"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb554-1"><a href="programming.html#cb554-1"></a><span class="co"># A numeric vector</span></span>
<span id="cb554-2"><a href="programming.html#cb554-2"></a>unifvec &lt;-<span class="st"> </span><span class="kw">runif</span>(<span class="dv">10</span>, <span class="dv">1</span>,<span class="dv">2</span>)</span>
<span id="cb554-3"><a href="programming.html#cb554-3"></a></span>
<span id="cb554-4"><a href="programming.html#cb554-4"></a><span class="co"># The sample mean</span></span>
<span id="cb554-5"><a href="programming.html#cb554-5"></a><span class="kw">mean</span>(unifvec)</span></code></pre></div>
<pre><code>## [1] 1.47523</code></pre>
<div class="sourceCode" id="cb556"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb556-1"><a href="programming.html#cb556-1"></a><span class="co"># Standard error for the mean</span></span>
<span id="cb556-2"><a href="programming.html#cb556-2"></a><span class="kw">SEmean</span>(unifvec)</span></code></pre></div>
<pre><code>## [1] 0.1017556</code></pre>

<div class="rmdinfo">
In general, avoid using names for your functions that are already in use by base R, or commonly used add-on packages. If two or more functions with the same name have been defined, R will first use the one defined by the user (and available in the ‘global environmment’), see Section <a href="masteringpackages.html#searchpath">8.4</a>.
</div>

<div id="returning-results" class="section level3">
<h3><span class="header-section-number">4.2.1</span> Returning results</h3>
<p>What if a function should return not just one result, as in the examples above, but many results?</p>
<p>For example, this function computes the standard deviation and standard error of a vector, and returns both stored in a vector. Note that we also use the <code>SEmean</code> function, which we defined above.</p>
<div class="sourceCode" id="cb558"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb558-1"><a href="programming.html#cb558-1"></a><span class="co"># An function that computes the SE and SD of a vector</span></span>
<span id="cb558-2"><a href="programming.html#cb558-2"></a>seandsd &lt;-<span class="st"> </span><span class="cf">function</span>(x){</span>
<span id="cb558-3"><a href="programming.html#cb558-3"></a>  </span>
<span id="cb558-4"><a href="programming.html#cb558-4"></a>  seresult &lt;-<span class="st"> </span><span class="kw">SEmean</span>(x)</span>
<span id="cb558-5"><a href="programming.html#cb558-5"></a>  sdresult &lt;-<span class="st"> </span><span class="kw">sd</span>(x)</span>
<span id="cb558-6"><a href="programming.html#cb558-6"></a></span>
<span id="cb558-7"><a href="programming.html#cb558-7"></a>  <span class="co"># Store results in a vector with names</span></span>
<span id="cb558-8"><a href="programming.html#cb558-8"></a>  vec &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dt">SE =</span> seresult, <span class="dt">SD =</span> sdresult)</span>
<span id="cb558-9"><a href="programming.html#cb558-9"></a></span>
<span id="cb558-10"><a href="programming.html#cb558-10"></a><span class="kw">return</span>(vec)</span>
<span id="cb558-11"><a href="programming.html#cb558-11"></a>}</span>
<span id="cb558-12"><a href="programming.html#cb558-12"></a></span>
<span id="cb558-13"><a href="programming.html#cb558-13"></a><span class="co"># Test it:</span></span>
<span id="cb558-14"><a href="programming.html#cb558-14"></a>x &lt;-<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">100</span>, <span class="dt">mean=</span><span class="dv">20</span>, <span class="dt">sd=</span><span class="dv">4</span>)</span>
<span id="cb558-15"><a href="programming.html#cb558-15"></a><span class="kw">seandsd</span>(x)</span></code></pre></div>
<pre><code>##        SE        SD 
## 0.4188749 4.1887492</code></pre>
</div>
<div id="functions-without-arguments" class="section level3">
<h3><span class="header-section-number">4.2.2</span> Functions without arguments</h3>
<p>Sometimes, a function takes no arguments (input) at all.</p>
<div class="sourceCode" id="cb560"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb560-1"><a href="programming.html#cb560-1"></a>sayhello &lt;-<span class="st"> </span><span class="cf">function</span>()<span class="kw">message</span>(<span class="st">&quot;Hello!&quot;</span>)</span>
<span id="cb560-2"><a href="programming.html#cb560-2"></a></span>
<span id="cb560-3"><a href="programming.html#cb560-3"></a><span class="kw">sayhello</span>()</span></code></pre></div>
<pre><code>## Hello!</code></pre>
<p>We now know enough about writing functions to start using them in many real-world applications, but return to writing more advanced functions in Section <a href="programming.html#functionsadvanced">4.5</a>.</p>
<p>First, we take a close look at the most versatile data structure in R : the list.</p>
</div>
</div>
<div id="workinglists" class="section level2">
<h2><span class="header-section-number">4.3</span> Working with lists</h2>
<p>Sofar, we have worked a lot with vectors, with are basically strings of numbers or bits of text. In a vector, each element has to be of the same data type. Lists are a more general and powerful type of vector, where each element of the <code>list</code> can be anything at all. This way, lists are a very flexible type of object to store a lot of information that may be in different formats.</p>
<p>Lists can be somewhat daunting for the beginning <code>R</code> user, which is why most introductory texts and tutorials skip them altogether. However, with some practice, lists can be mastered from the start. Mastering a few basic skills with lists can really help increase your efficiency in dealing with more complex data analysis tasks.</p>
<p>To make a list from scratch, you simply use the <code>list</code> function. Here is a list that contains a numeric vector, a character vector, and a dataframe:</p>
<div class="sourceCode" id="cb562"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb562-1"><a href="programming.html#cb562-1"></a>mylist &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">a=</span><span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dt">txt=</span><span class="kw">c</span>(<span class="st">&quot;hello&quot;</span>,<span class="st">&quot;world&quot;</span>), <span class="dt">dfr=</span><span class="kw">data.frame</span>(<span class="dt">x=</span><span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>),<span class="dt">y=</span><span class="kw">c</span>(<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>)))</span></code></pre></div>
<div id="indexing-lists" class="section level3">
<h3><span class="header-section-number">4.3.1</span> Indexing lists</h3>
<p>To extract an element from this list, you may do this by its name (‘a’,‘txt’ or ‘dfr’ in this case), or by the element number (1,2,3). For lists, we use a double square bracket for indexing. Consider these examples,</p>
<div class="sourceCode" id="cb563"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb563-1"><a href="programming.html#cb563-1"></a><span class="co"># Extract the dataframe:</span></span>
<span id="cb563-2"><a href="programming.html#cb563-2"></a>mylist[[<span class="st">&quot;dfr&quot;</span>]]</span></code></pre></div>
<pre><code>##   x y
## 1 2 5
## 2 3 6
## 3 4 7</code></pre>
<div class="sourceCode" id="cb565"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb565-1"><a href="programming.html#cb565-1"></a><span class="co"># Is the same as:</span></span>
<span id="cb565-2"><a href="programming.html#cb565-2"></a>mylist<span class="op">$</span>dfr</span></code></pre></div>
<pre><code>##   x y
## 1 2 5
## 2 3 6
## 3 4 7</code></pre>
<div class="sourceCode" id="cb567"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb567-1"><a href="programming.html#cb567-1"></a><span class="co"># Extract the first element:</span></span>
<span id="cb567-2"><a href="programming.html#cb567-2"></a>mylist[[<span class="dv">1</span>]]</span></code></pre></div>
<pre><code>##  [1]  1  2  3  4  5  6  7  8  9 10</code></pre>
<p>Note that in these examples, the contents of the elements of the list are returned (for ‘dfr’, a dataframe), but the result itself is not a list anymore. If we select multiple elements, the result should still be a list. To do this, use the single square bracket.</p>
<p>Look at these examples:</p>
<div class="sourceCode" id="cb569"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb569-1"><a href="programming.html#cb569-1"></a><span class="co"># Extract the &#39;a&#39; vector, result is a vector:</span></span>
<span id="cb569-2"><a href="programming.html#cb569-2"></a>mylist[[<span class="st">&#39;a&#39;</span>]]</span></code></pre></div>
<pre><code>##  [1]  1  2  3  4  5  6  7  8  9 10</code></pre>
<div class="sourceCode" id="cb571"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb571-1"><a href="programming.html#cb571-1"></a><span class="co"># Extract the &#39;a&#39; vector, result is a list:</span></span>
<span id="cb571-2"><a href="programming.html#cb571-2"></a>mylist[<span class="st">&#39;a&#39;</span>]</span></code></pre></div>
<pre><code>## $a
##  [1]  1  2  3  4  5  6  7  8  9 10</code></pre>
<div class="sourceCode" id="cb573"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb573-1"><a href="programming.html#cb573-1"></a><span class="co"># Extract multiple elements (result is still a list):</span></span>
<span id="cb573-2"><a href="programming.html#cb573-2"></a>mylist[<span class="dv">2</span><span class="op">:</span><span class="dv">3</span>]</span></code></pre></div>
<pre><code>## $txt
## [1] &quot;hello&quot; &quot;world&quot;
## 
## $dfr
##   x y
## 1 2 5
## 2 3 6
## 3 4 7</code></pre>
</div>
<div id="converting-lists-to-dataframes-or-vectors" class="section level3">
<h3><span class="header-section-number">4.3.2</span> Converting lists to dataframes or vectors</h3>
<p>Although lists are the most flexible way to store data and other objects in larger, more complex, analyses, ultimately you would prefer to output as a dataframe or vector.</p>
<p>Let’s look at some examples using <code>do.call(rbind,...)</code> and <code>unlist</code>.</p>
<div class="sourceCode" id="cb575"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb575-1"><a href="programming.html#cb575-1"></a><span class="co"># A list of dataframes:</span></span>
<span id="cb575-2"><a href="programming.html#cb575-2"></a>dfrlis &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">data1=</span><span class="kw">data.frame</span>(<span class="dt">a=</span><span class="dv">1</span><span class="op">:</span><span class="dv">3</span>,<span class="dt">b=</span><span class="dv">2</span><span class="op">:</span><span class="dv">4</span>), <span class="dt">data2=</span><span class="kw">data.frame</span>(<span class="dt">a=</span><span class="dv">9</span><span class="op">:</span><span class="dv">11</span>,<span class="dt">b=</span><span class="dv">15</span><span class="op">:</span><span class="dv">17</span>))</span>
<span id="cb575-3"><a href="programming.html#cb575-3"></a>dfrlis</span></code></pre></div>
<pre><code>## $data1
##   a b
## 1 1 2
## 2 2 3
## 3 3 4
## 
## $data2
##    a  b
## 1  9 15
## 2 10 16
## 3 11 17</code></pre>
<div class="sourceCode" id="cb577"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb577-1"><a href="programming.html#cb577-1"></a><span class="co"># Since both dataframes in the list have the same number of columns and names, </span></span>
<span id="cb577-2"><a href="programming.html#cb577-2"></a><span class="co"># we can &#39;successively row-bind&#39; the list like this:</span></span>
<span id="cb577-3"><a href="programming.html#cb577-3"></a><span class="kw">do.call</span>(rbind, dfrlis)</span></code></pre></div>
<pre><code>##          a  b
## data1.1  1  2
## data1.2  2  3
## data1.3  3  4
## data2.1  9 15
## data2.2 10 16
## data2.3 11 17</code></pre>
<div class="sourceCode" id="cb579"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb579-1"><a href="programming.html#cb579-1"></a><span class="co"># A list of vectors:</span></span>
<span id="cb579-2"><a href="programming.html#cb579-2"></a>veclis &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">a=</span><span class="dv">1</span><span class="op">:</span><span class="dv">3</span>, <span class="dt">b=</span><span class="dv">2</span><span class="op">:</span><span class="dv">4</span>, <span class="dt">f=</span><span class="dv">9</span><span class="op">:</span><span class="dv">11</span>)</span>
<span id="cb579-3"><a href="programming.html#cb579-3"></a></span>
<span id="cb579-4"><a href="programming.html#cb579-4"></a><span class="co"># In this case, we can use the &#39;unlist&#39; function, which will </span></span>
<span id="cb579-5"><a href="programming.html#cb579-5"></a><span class="co"># successively combine the three vectors into one:</span></span>
<span id="cb579-6"><a href="programming.html#cb579-6"></a><span class="kw">unlist</span>(veclis)</span></code></pre></div>
<pre><code>## a1 a2 a3 b1 b2 b3 f1 f2 f3 
##  1  2  3  2  3  4  9 10 11</code></pre>
<p>In real-world applications, some trial-and-error will be necessary to convert lists to more pretty formats.</p>
</div>
<div id="combining-lists" class="section level3">
<h3><span class="header-section-number">4.3.3</span> Combining lists</h3>
<p>Combining two lists can be achieved using <code>c()</code>, like this:</p>
<div class="sourceCode" id="cb581"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb581-1"><a href="programming.html#cb581-1"></a>veclis &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">a=</span><span class="dv">1</span><span class="op">:</span><span class="dv">3</span>, <span class="dt">b=</span><span class="dv">2</span><span class="op">:</span><span class="dv">4</span>, <span class="dt">f=</span><span class="dv">9</span><span class="op">:</span><span class="dv">11</span>)</span>
<span id="cb581-2"><a href="programming.html#cb581-2"></a>qlis &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">q=</span><span class="dv">17</span><span class="op">:</span><span class="dv">15</span>)</span>
<span id="cb581-3"><a href="programming.html#cb581-3"></a><span class="kw">c</span>(veclis,qlis)</span></code></pre></div>
<pre><code>## $a
## [1] 1 2 3
## 
## $b
## [1] 2 3 4
## 
## $f
## [1]  9 10 11
## 
## $q
## [1] 17 16 15</code></pre>
<div class="sourceCode" id="cb583"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb583-1"><a href="programming.html#cb583-1"></a><span class="co"># But be careful when you like to quickly add a vector</span></span>
<span id="cb583-2"><a href="programming.html#cb583-2"></a><span class="co"># the &#39;veclis&#39;. You must specify list() like this</span></span>
<span id="cb583-3"><a href="programming.html#cb583-3"></a>veclis &lt;-<span class="st"> </span><span class="kw">c</span>(veclis, <span class="kw">list</span>(<span class="dt">r=</span><span class="dv">3</span><span class="op">:</span><span class="dv">1</span>))</span></code></pre></div>
</div>
<div id="extracting-output-from-built-in-functions" class="section level3">
<h3><span class="header-section-number">4.3.4</span> Extracting output from built-in functions</h3>
<p>One reason to gain a better understanding of lists is that many built-in functions return not just single numbers, but a diverse collection of outputs, organized in lists. Think of the linear model function (<code>lm</code>), it returns a lot of things at the same time (not just the p-value).</p>
<p>Let’s take a closer look at the <code>lm</code> output to see if we can extract the adjusted R<span class="math inline">\(^2\)</span>.</p>
<div class="sourceCode" id="cb584"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb584-1"><a href="programming.html#cb584-1"></a><span class="co"># Read data</span></span>
<span id="cb584-2"><a href="programming.html#cb584-2"></a><span class="kw">data</span>(allometry)</span>
<span id="cb584-3"><a href="programming.html#cb584-3"></a></span>
<span id="cb584-4"><a href="programming.html#cb584-4"></a><span class="co"># Fit a linear model</span></span>
<span id="cb584-5"><a href="programming.html#cb584-5"></a>lmfit &lt;-<span class="st"> </span><span class="kw">lm</span>(height <span class="op">~</span><span class="st"> </span>diameter, <span class="dt">data=</span>allometry)</span>
<span id="cb584-6"><a href="programming.html#cb584-6"></a></span>
<span id="cb584-7"><a href="programming.html#cb584-7"></a><span class="co"># And save the summary statement of the model:</span></span>
<span id="cb584-8"><a href="programming.html#cb584-8"></a>lmfit_summary &lt;-<span class="st"> </span><span class="kw">summary</span>(lmfit)</span>
<span id="cb584-9"><a href="programming.html#cb584-9"></a></span>
<span id="cb584-10"><a href="programming.html#cb584-10"></a><span class="co"># We already know that simply typing &#39;summary(lmfit)&#39; will give </span></span>
<span id="cb584-11"><a href="programming.html#cb584-11"></a><span class="co"># lots of text output. How to extract numbers from there?</span></span>
<span id="cb584-12"><a href="programming.html#cb584-12"></a><span class="co"># Let&#39;s look at the structure of lmfit:</span></span>
<span id="cb584-13"><a href="programming.html#cb584-13"></a><span class="kw">str</span>(lmfit_summary)</span></code></pre></div>
<pre><code>## List of 11
##  $ call         : language lm(formula = height ~ diameter, data = allometry)
##  $ terms        :Classes &#39;terms&#39;, &#39;formula&#39;  language height ~ diameter
##   .. ..- attr(*, &quot;variables&quot;)= language list(height, diameter)
##   .. ..- attr(*, &quot;factors&quot;)= int [1:2, 1] 0 1
##   .. .. ..- attr(*, &quot;dimnames&quot;)=List of 2
##   .. .. .. ..$ : chr [1:2] &quot;height&quot; &quot;diameter&quot;
##   .. .. .. ..$ : chr &quot;diameter&quot;
##   .. ..- attr(*, &quot;term.labels&quot;)= chr &quot;diameter&quot;
##   .. ..- attr(*, &quot;order&quot;)= int 1
##   .. ..- attr(*, &quot;intercept&quot;)= int 1
##   .. ..- attr(*, &quot;response&quot;)= int 1
##   .. ..- attr(*, &quot;.Environment&quot;)=&lt;environment: R_GlobalEnv&gt; 
##   .. ..- attr(*, &quot;predvars&quot;)= language list(height, diameter)
##   .. ..- attr(*, &quot;dataClasses&quot;)= Named chr [1:2] &quot;numeric&quot; &quot;numeric&quot;
##   .. .. ..- attr(*, &quot;names&quot;)= chr [1:2] &quot;height&quot; &quot;diameter&quot;
##  $ residuals    : Named num [1:63] -8.84 1.8 0.743 2.499 4.37 ...
##   ..- attr(*, &quot;names&quot;)= chr [1:63] &quot;1&quot; &quot;2&quot; &quot;3&quot; &quot;4&quot; ...
##  $ coefficients : num [1:2, 1:4] 7.5967 0.5179 1.4731 0.0365 5.157 ...
##   ..- attr(*, &quot;dimnames&quot;)=List of 2
##   .. ..$ : chr [1:2] &quot;(Intercept)&quot; &quot;diameter&quot;
##   .. ..$ : chr [1:4] &quot;Estimate&quot; &quot;Std. Error&quot; &quot;t value&quot; &quot;Pr(&gt;|t|)&quot;
##  $ aliased      : Named logi [1:2] FALSE FALSE
##   ..- attr(*, &quot;names&quot;)= chr [1:2] &quot;(Intercept)&quot; &quot;diameter&quot;
##  $ sigma        : num 5.55
##  $ df           : int [1:3] 2 61 2
##  $ r.squared    : num 0.768
##  $ adj.r.squared: num 0.764
##  $ fstatistic   : Named num [1:3] 202 1 61
##   ..- attr(*, &quot;names&quot;)= chr [1:3] &quot;value&quot; &quot;numdf&quot; &quot;dendf&quot;
##  $ cov.unscaled : num [1:2, 1:2] 7.05e-02 -1.54e-03 -1.54e-03 4.32e-05
##   ..- attr(*, &quot;dimnames&quot;)=List of 2
##   .. ..$ : chr [1:2] &quot;(Intercept)&quot; &quot;diameter&quot;
##   .. ..$ : chr [1:2] &quot;(Intercept)&quot; &quot;diameter&quot;
##  - attr(*, &quot;class&quot;)= chr &quot;summary.lm&quot;</code></pre>
<div class="sourceCode" id="cb586"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb586-1"><a href="programming.html#cb586-1"></a><span class="co"># The output of lm is a list, so we can look at the names of # that list as well:</span></span>
<span id="cb586-2"><a href="programming.html#cb586-2"></a><span class="kw">names</span>(lmfit_summary)</span></code></pre></div>
<pre><code>##  [1] &quot;call&quot;          &quot;terms&quot;         &quot;residuals&quot;     &quot;coefficients&quot; 
##  [5] &quot;aliased&quot;       &quot;sigma&quot;         &quot;df&quot;            &quot;r.squared&quot;    
##  [9] &quot;adj.r.squared&quot; &quot;fstatistic&quot;    &quot;cov.unscaled&quot;</code></pre>
<p>So, now we can extract results from the summary of the fitted regression. Also look at the help file <code>?summary.lm</code>, in the section ‘Values’ for a description of the fields contained here.</p>
<p>To extract the adjusted R<span class="math inline">\(^2\)</span>, for example:</p>
<div class="sourceCode" id="cb588"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb588-1"><a href="programming.html#cb588-1"></a>lmfit_summary[[<span class="st">&quot;adj.r.squared&quot;</span>]]</span></code></pre></div>
<pre><code>## [1] 0.7639735</code></pre>
<div class="sourceCode" id="cb590"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb590-1"><a href="programming.html#cb590-1"></a><span class="co"># Is the same as:</span></span>
<span id="cb590-2"><a href="programming.html#cb590-2"></a>lmfit_summary<span class="op">$</span>adj.r.squared</span></code></pre></div>
<pre><code>## [1] 0.7639735</code></pre>
<p>This sort of analysis will be very useful when we do many regressions, and want to summarize the results in a table.</p>

<div class="rmdtry">
Run the code in the above examples, and practice extracting some other elements from the linear regression. Compare the output to the summary of the <code>lm</code> fit (that is, compare it to what <code>summary(lmfit)</code> shows on screen).
</div>

</div>
<div id="dfrlists" class="section level3">
<h3><span class="header-section-number">4.3.5</span> Creating lists from dataframes</h3>
<p>For more advanced analyses, it is often necessary to repeat a particular analysis many times, for example for sections of a dataframe.</p>
<p>Using the <code>allom</code> data for example, we might want to split the dataframe into three dataframes (one for each species), and repeat some analysis for each of the species. One option is to make three subsets (using <code>subset</code>), and repeating the analysis for each of them. But what if we have hundreds of species?</p>
<p>A more efficient approach is to <code>split</code> the dataframe into a list, so that the first element of the list is the dataframe for species 1, the 2nd element species 2, and so on. In case of the allom dataset, the resulting list will have three components.</p>
<p>Let’s look at an example on how to construct a list of dataframes from the allom dataset, one per species:</p>
<div class="sourceCode" id="cb592"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb592-1"><a href="programming.html#cb592-1"></a><span class="co"># Read allom data and make sure &#39;species&#39; is a factor:</span></span>
<span id="cb592-2"><a href="programming.html#cb592-2"></a><span class="kw">data</span>(allometry)</span>
<span id="cb592-3"><a href="programming.html#cb592-3"></a><span class="kw">is.factor</span>(allometry<span class="op">$</span>species)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb594"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb594-1"><a href="programming.html#cb594-1"></a><span class="co"># The levels of the factor variable &#39;species&#39;</span></span>
<span id="cb594-2"><a href="programming.html#cb594-2"></a><span class="kw">levels</span>(allometry<span class="op">$</span>species)</span></code></pre></div>
<pre><code>## [1] &quot;PIMO&quot; &quot;PIPO&quot; &quot;PSME&quot;</code></pre>
<div class="sourceCode" id="cb596"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb596-1"><a href="programming.html#cb596-1"></a><span class="co"># Now use &#39;split&#39; to construct a list:</span></span>
<span id="cb596-2"><a href="programming.html#cb596-2"></a>allomsp &lt;-<span class="st"> </span><span class="kw">split</span>(allometry, allometry<span class="op">$</span>species)</span>
<span id="cb596-3"><a href="programming.html#cb596-3"></a></span>
<span id="cb596-4"><a href="programming.html#cb596-4"></a><span class="co"># The length of the list should be 3, with the names equal to the </span></span>
<span id="cb596-5"><a href="programming.html#cb596-5"></a><span class="co"># original factor levels:</span></span>
<span id="cb596-6"><a href="programming.html#cb596-6"></a><span class="kw">length</span>(allomsp)</span></code></pre></div>
<pre><code>## [1] 3</code></pre>
<div class="sourceCode" id="cb598"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb598-1"><a href="programming.html#cb598-1"></a><span class="kw">names</span>(allomsp)</span></code></pre></div>
<pre><code>## [1] &quot;PIMO&quot; &quot;PIPO&quot; &quot;PSME&quot;</code></pre>

<div class="rmdtry">
Run the code in the above example, and confirm that <code>allomsp[[2]]</code> is identical to taking a subset of <code>allom</code> of the second species in the dataset (where ‘second’ refers to the second level of the factor variable <code>species</code>, which you can find out with <code>levels</code>).
</div>

<p>Let’s look at an example using the <code>hydro</code> data. The data contains water levels of a hydrodam in Tasmania, from 2005 to 2011.</p>
<div class="sourceCode" id="cb600"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb600-1"><a href="programming.html#cb600-1"></a><span class="co"># Read hydro data, and convert Date to a proper date class.</span></span>
<span id="cb600-2"><a href="programming.html#cb600-2"></a><span class="kw">data</span>(hydro)</span>
<span id="cb600-3"><a href="programming.html#cb600-3"></a></span>
<span id="cb600-4"><a href="programming.html#cb600-4"></a><span class="kw">library</span>(lubridate)</span>
<span id="cb600-5"><a href="programming.html#cb600-5"></a><span class="kw">library</span>(dplyr)</span>
<span id="cb600-6"><a href="programming.html#cb600-6"></a></span>
<span id="cb600-7"><a href="programming.html#cb600-7"></a>hydro &lt;-<span class="st"> </span><span class="kw">mutate</span>(hydro, </span>
<span id="cb600-8"><a href="programming.html#cb600-8"></a>                <span class="dt">Date =</span> <span class="kw">dmy</span>(Date),</span>
<span id="cb600-9"><a href="programming.html#cb600-9"></a>                <span class="dt">year =</span> <span class="kw">year</span>(Date))</span>
<span id="cb600-10"><a href="programming.html#cb600-10"></a></span>
<span id="cb600-11"><a href="programming.html#cb600-11"></a><span class="co"># Look at the Date range:</span></span>
<span id="cb600-12"><a href="programming.html#cb600-12"></a><span class="kw">range</span>(hydro<span class="op">$</span>Date)</span></code></pre></div>
<pre><code>## [1] &quot;2005-08-08&quot; &quot;2011-08-08&quot;</code></pre>
<div class="sourceCode" id="cb602"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb602-1"><a href="programming.html#cb602-1"></a><span class="co"># Let&#39;s get rid of the first and last years (2005 and 2011) since they are incomplete</span></span>
<span id="cb602-2"><a href="programming.html#cb602-2"></a>hydro &lt;-<span class="st"> </span><span class="kw">filter</span>(hydro, <span class="op">!</span>year <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="dv">2005</span>,<span class="dv">2011</span>))</span>
<span id="cb602-3"><a href="programming.html#cb602-3"></a></span>
<span id="cb602-4"><a href="programming.html#cb602-4"></a><span class="co"># Now split the dataframe by year. This results in a list, where every</span></span>
<span id="cb602-5"><a href="programming.html#cb602-5"></a><span class="co"># element contains the data for one year:</span></span>
<span id="cb602-6"><a href="programming.html#cb602-6"></a>hydrosp &lt;-<span class="st"> </span><span class="kw">split</span>(hydro, hydro<span class="op">$</span>year)</span>
<span id="cb602-7"><a href="programming.html#cb602-7"></a></span>
<span id="cb602-8"><a href="programming.html#cb602-8"></a><span class="co"># Properties of this list:</span></span>
<span id="cb602-9"><a href="programming.html#cb602-9"></a><span class="kw">length</span>(hydrosp)</span></code></pre></div>
<pre><code>## [1] 5</code></pre>
<div class="sourceCode" id="cb604"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb604-1"><a href="programming.html#cb604-1"></a><span class="kw">names</span>(hydrosp)</span></code></pre></div>
<pre><code>## [1] &quot;2006&quot; &quot;2007&quot; &quot;2008&quot; &quot;2009&quot; &quot;2010&quot;</code></pre>
<p>To extract one element of the two lists that we created (<code>allomsp</code> and <code>hydrosp</code>), recall the section on indexing lists.</p>
</div>
<div id="lapply" class="section level3">
<h3><span class="header-section-number">4.3.6</span> Applying functions to lists</h3>
<p>We will introduce two basic tools that we use to apply functions to each element of a list: <code>sapply</code> and <code>lapply</code>. The <code>lapply</code> function always returns a list, whereas <code>sapply</code> will attempt to <code>s</code>implify the result. When the function returns a single value, or a vector, <code>sapply</code> can often be used. In practice, try both and see what happens!</p>
<div id="using-sapply" class="section level4">
<h4><span class="header-section-number">4.3.6.1</span> Using <code>sapply</code></h4>
<p>First let’s look at some simple examples:</p>
<div class="sourceCode" id="cb606"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb606-1"><a href="programming.html#cb606-1"></a><span class="co"># Let&#39;s make a simple list with only numeric vectors (of varying length)</span></span>
<span id="cb606-2"><a href="programming.html#cb606-2"></a>numlis &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">x=</span><span class="dv">1000</span>, <span class="dt">y=</span><span class="kw">c</span>(<span class="fl">2.1</span>,<span class="fl">0.1</span>,<span class="op">-</span><span class="dv">19</span>), <span class="dt">z=</span><span class="kw">c</span>(<span class="dv">100</span>,<span class="dv">200</span>,<span class="dv">100</span>,<span class="dv">100</span>))</span>
<span id="cb606-3"><a href="programming.html#cb606-3"></a></span>
<span id="cb606-4"><a href="programming.html#cb606-4"></a><span class="co"># For the numeric list, let&#39;s get the mean for every element, and count </span></span>
<span id="cb606-5"><a href="programming.html#cb606-5"></a><span class="co"># the length of the three vectors.</span></span>
<span id="cb606-6"><a href="programming.html#cb606-6"></a><span class="co"># Here, sapply takes a list and a function as its two arguments,</span></span>
<span id="cb606-7"><a href="programming.html#cb606-7"></a><span class="co"># and applies that function to each element of the list.</span></span>
<span id="cb606-8"><a href="programming.html#cb606-8"></a><span class="kw">sapply</span>(numlis, mean)</span></code></pre></div>
<pre><code>##      x      y      z 
## 1000.0   -5.6  125.0</code></pre>
<div class="sourceCode" id="cb608"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb608-1"><a href="programming.html#cb608-1"></a><span class="kw">sapply</span>(numlis, length)</span></code></pre></div>
<pre><code>## x y z 
## 1 3 4</code></pre>
<p>You can of course also define your own functions, and use them here. Let’s look at another simple example using the <code>numlis</code> object defined above.</p>
<p>For example,</p>
<div class="sourceCode" id="cb610"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb610-1"><a href="programming.html#cb610-1"></a><span class="co"># Let&#39;s find out if any diameters are duplicated in the allom dataset.</span></span>
<span id="cb610-2"><a href="programming.html#cb610-2"></a><span class="co"># A function that does this would be the combination of &#39;any&#39; and &#39;duplicated&#39;,</span></span>
<span id="cb610-3"><a href="programming.html#cb610-3"></a>anydup &lt;-<span class="st"> </span><span class="cf">function</span>(vec)<span class="kw">any</span>(<span class="kw">duplicated</span>(vec))</span>
<span id="cb610-4"><a href="programming.html#cb610-4"></a><span class="co"># This function returns TRUE or FALSE</span></span>
<span id="cb610-5"><a href="programming.html#cb610-5"></a></span>
<span id="cb610-6"><a href="programming.html#cb610-6"></a><span class="co"># Apply this function to numlis (see above):</span></span>
<span id="cb610-7"><a href="programming.html#cb610-7"></a><span class="kw">sapply</span>(numlis, anydup)</span></code></pre></div>
<pre><code>##     x     y     z 
## FALSE FALSE  TRUE</code></pre>
<div class="sourceCode" id="cb612"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb612-1"><a href="programming.html#cb612-1"></a><span class="co"># You can also define the function on the fly like this:</span></span>
<span id="cb612-2"><a href="programming.html#cb612-2"></a><span class="kw">sapply</span>(numlis, <span class="cf">function</span>(x)<span class="kw">any</span>(<span class="kw">duplicated</span>(x)))</span></code></pre></div>
<pre><code>##     x     y     z 
## FALSE FALSE  TRUE</code></pre>
<p>Now, you can use any function in <code>sapply</code> as long as it returns a single number based on the element of the list that you used it on. Consider this example with <code>strsplit</code>.</p>
<div class="sourceCode" id="cb614"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb614-1"><a href="programming.html#cb614-1"></a><span class="co"># Recall that the &#39;strsplit&#39; (string split) function usually returns a list of values. </span></span>
<span id="cb614-2"><a href="programming.html#cb614-2"></a><span class="co"># Consider the following example, where the data provider has included the units in </span></span>
<span id="cb614-3"><a href="programming.html#cb614-3"></a><span class="co"># the measurements of fish lengths. How do we extract the number bits?</span></span>
<span id="cb614-4"><a href="programming.html#cb614-4"></a>fishlength &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;120 mm&quot;</span>, <span class="st">&quot;240 mm&quot;</span>, <span class="st">&quot;159 mm&quot;</span>, <span class="st">&quot;201 mm&quot;</span>)</span>
<span id="cb614-5"><a href="programming.html#cb614-5"></a></span>
<span id="cb614-6"><a href="programming.html#cb614-6"></a><span class="co"># Here is one solution, using strsplit</span></span>
<span id="cb614-7"><a href="programming.html#cb614-7"></a><span class="kw">strsplit</span>(fishlength,<span class="st">&quot; &quot;</span>)</span></code></pre></div>
<pre><code>## [[1]]
## [1] &quot;120&quot; &quot;mm&quot; 
## 
## [[2]]
## [1] &quot;240&quot; &quot;mm&quot; 
## 
## [[3]]
## [1] &quot;159&quot; &quot;mm&quot; 
## 
## [[4]]
## [1] &quot;201&quot; &quot;mm&quot;</code></pre>
<div class="sourceCode" id="cb616"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb616-1"><a href="programming.html#cb616-1"></a><span class="co"># We see that strsplit returns a list, let&#39;s use sapply to extract only </span></span>
<span id="cb616-2"><a href="programming.html#cb616-2"></a><span class="co"># the first element (the number)</span></span>
<span id="cb616-3"><a href="programming.html#cb616-3"></a>splitlen &lt;-<span class="st"> </span><span class="kw">strsplit</span>(fishlength,<span class="st">&quot; &quot;</span>)</span>
<span id="cb616-4"><a href="programming.html#cb616-4"></a><span class="kw">sapply</span>(splitlen, <span class="cf">function</span>(x)x[<span class="dv">1</span>])</span></code></pre></div>
<pre><code>## [1] &quot;120&quot; &quot;240&quot; &quot;159&quot; &quot;201&quot;</code></pre>
<div class="sourceCode" id="cb618"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb618-1"><a href="programming.html#cb618-1"></a><span class="co"># Now all you need to do is use &#39;as.numeric&#39; to convert these bits of text to numbers.</span></span></code></pre></div>
<p>The main purpose of splitting dataframes into lists, as we have done above, is so that we can save time with analyses that have to be repeated many times. In the following examples, you must have already produced the objects <code>hydrosp</code> and <code>allomsp</code> (from examples in the previous section).Both those objects are <em>lists of dataframes</em>, that is, each element of the list is a dataframe in itself. Let’s look at a few examples with <code>sapply</code> first.</p>
<div class="sourceCode" id="cb619"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb619-1"><a href="programming.html#cb619-1"></a><span class="co"># How many observations per species in the allom dataset?</span></span>
<span id="cb619-2"><a href="programming.html#cb619-2"></a><span class="kw">sapply</span>(allomsp, nrow)</span></code></pre></div>
<pre><code>## PIMO PIPO PSME 
##   19   22   22</code></pre>
<div class="sourceCode" id="cb621"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb621-1"><a href="programming.html#cb621-1"></a><span class="co"># Here, we applied the &#39;nrow&#39; function to each separate dataframe.</span></span>
<span id="cb621-2"><a href="programming.html#cb621-2"></a><span class="co"># (note that there are easier ways to find the number of observations per species!,</span></span>
<span id="cb621-3"><a href="programming.html#cb621-3"></a><span class="co"># this is just illustrating sapply.)</span></span>
<span id="cb621-4"><a href="programming.html#cb621-4"></a></span>
<span id="cb621-5"><a href="programming.html#cb621-5"></a><span class="co"># Things get more interesting when you define your own functions on the fly:</span></span>
<span id="cb621-6"><a href="programming.html#cb621-6"></a><span class="kw">sapply</span>(allomsp, <span class="cf">function</span>(x)<span class="kw">range</span>(x<span class="op">$</span>diameter))</span></code></pre></div>
<pre><code>##       PIMO  PIPO  PSME
## [1,]  6.48  4.83  5.33
## [2,] 73.66 70.61 69.85</code></pre>
<div class="sourceCode" id="cb623"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb623-1"><a href="programming.html#cb623-1"></a><span class="co"># Here, we define a function that takes &#39;x&#39; as an argument:</span></span>
<span id="cb623-2"><a href="programming.html#cb623-2"></a><span class="co"># sapply will apply this function to each element of the list,</span></span>
<span id="cb623-3"><a href="programming.html#cb623-3"></a><span class="co"># one at a time. In this case, we get a matrix with ranges of the diameter per species.</span></span>
<span id="cb623-4"><a href="programming.html#cb623-4"></a></span>
<span id="cb623-5"><a href="programming.html#cb623-5"></a><span class="co"># How about the correlation of two variables, separate by species:</span></span>
<span id="cb623-6"><a href="programming.html#cb623-6"></a><span class="kw">sapply</span>(allomsp, <span class="cf">function</span>(x)<span class="kw">cor</span>(x<span class="op">$</span>diameter, x<span class="op">$</span>height))</span></code></pre></div>
<pre><code>##      PIMO      PIPO      PSME 
## 0.9140428 0.8594689 0.8782781</code></pre>
<div class="sourceCode" id="cb625"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb625-1"><a href="programming.html#cb625-1"></a><span class="co"># For hydro, find the number of days that storage was below 235, for each year.</span></span>
<span id="cb625-2"><a href="programming.html#cb625-2"></a><span class="kw">sapply</span>(hydrosp, <span class="cf">function</span>(x)<span class="kw">sum</span>(x<span class="op">$</span>storage <span class="op">&lt;</span><span class="st"> </span><span class="dv">235</span>))</span></code></pre></div>
<pre><code>## 2006 2007 2008 2009 2010 
##    0   18    6    0    0</code></pre>
</div>
<div id="using-lapply" class="section level4">
<h4><span class="header-section-number">4.3.6.2</span> Using <code>lapply</code></h4>
<p>The <code>lapply</code> function is much like <code>sapply</code>, except it always returns a list.</p>
<p>For example,</p>
<div class="sourceCode" id="cb627"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb627-1"><a href="programming.html#cb627-1"></a><span class="co"># Get a summary of the hydro dataset by year:</span></span>
<span id="cb627-2"><a href="programming.html#cb627-2"></a><span class="kw">lapply</span>(hydrosp, summary)</span></code></pre></div>
<pre><code>## $`2006`
##       Date               storage           year     
##  Min.   :2006-01-02   Min.   :411.0   Min.   :2006  
##  1st Qu.:2006-04-01   1st Qu.:449.5   1st Qu.:2006  
##  Median :2006-06-29   Median :493.0   Median :2006  
##  Mean   :2006-06-29   Mean   :514.3   Mean   :2006  
##  3rd Qu.:2006-09-26   3rd Qu.:553.8   3rd Qu.:2006  
##  Max.   :2006-12-25   Max.   :744.0   Max.   :2006  
## 
## $`2007`
##       Date               storage           year     
##  Min.   :2007-01-01   Min.   :137.0   Min.   :2007  
##  1st Qu.:2007-04-02   1st Qu.:223.0   1st Qu.:2007  
##  Median :2007-07-02   Median :319.0   Median :2007  
##  Mean   :2007-07-02   Mean   :363.2   Mean   :2007  
##  3rd Qu.:2007-10-01   3rd Qu.:477.0   3rd Qu.:2007  
##  Max.   :2007-12-31   Max.   :683.0   Max.   :2007  
## 
## $`2008`
##       Date               storage           year     
##  Min.   :2008-01-07   Min.   :202.0   Min.   :2008  
##  1st Qu.:2008-04-05   1st Qu.:267.8   1st Qu.:2008  
##  Median :2008-07-03   Median :345.0   Median :2008  
##  Mean   :2008-07-03   Mean   :389.5   Mean   :2008  
##  3rd Qu.:2008-09-30   3rd Qu.:551.8   3rd Qu.:2008  
##  Max.   :2008-12-29   Max.   :637.0   Max.   :2008  
## 
## $`2009`
##       Date               storage           year     
##  Min.   :2009-01-05   Min.   :398.0   Min.   :2009  
##  1st Qu.:2009-04-04   1st Qu.:467.0   1st Qu.:2009  
##  Median :2009-07-02   Median :525.5   Median :2009  
##  Mean   :2009-07-02   Mean   :567.6   Mean   :2009  
##  3rd Qu.:2009-09-29   3rd Qu.:677.8   3rd Qu.:2009  
##  Max.   :2009-12-28   Max.   :791.0   Max.   :2009  
## 
## $`2010`
##       Date               storage           year     
##  Min.   :2010-01-04   Min.   :251.0   Min.   :2010  
##  1st Qu.:2010-04-03   1st Qu.:316.0   1st Qu.:2010  
##  Median :2010-07-01   Median :368.5   Median :2010  
##  Mean   :2010-07-01   Mean   :428.5   Mean   :2010  
##  3rd Qu.:2010-09-28   3rd Qu.:577.5   3rd Qu.:2010  
##  Max.   :2010-12-27   Max.   :649.0   Max.   :2010</code></pre>
<p>Suppose you have multiple similar datasets in your working directory, and you want to read all of these into one list, use <code>lapply</code> like this (run this example yourself and inspect the results).</p>
<div class="sourceCode" id="cb629"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb629-1"><a href="programming.html#cb629-1"></a><span class="co"># Names of your datasets:</span></span>
<span id="cb629-2"><a href="programming.html#cb629-2"></a>filenames &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;pupae.csv&quot;</span>,<span class="st">&quot;pupae.csv&quot;</span>,<span class="st">&quot;pupae.csv&quot;</span>)</span>
<span id="cb629-3"><a href="programming.html#cb629-3"></a><span class="co"># (This toy example will read the same file three times).</span></span>
<span id="cb629-4"><a href="programming.html#cb629-4"></a></span>
<span id="cb629-5"><a href="programming.html#cb629-5"></a><span class="co"># Read all files into one list,</span></span>
<span id="cb629-6"><a href="programming.html#cb629-6"></a>alldata &lt;-<span class="st"> </span><span class="kw">lapply</span>(filenames, read.csv)</span>
<span id="cb629-7"><a href="programming.html#cb629-7"></a></span>
<span id="cb629-8"><a href="programming.html#cb629-8"></a><span class="co"># Then, if you are sure the datasets have the same number of columns and names,</span></span>
<span id="cb629-9"><a href="programming.html#cb629-9"></a><span class="co"># use do.call to collapse the list:</span></span>
<span id="cb629-10"><a href="programming.html#cb629-10"></a>dfrall &lt;-<span class="st"> </span><span class="kw">do.call</span>(rbind, alldata)</span></code></pre></div>

<div class="rmdtry">
Recall the use of <code>dir</code> to list files, and even to find files that match a specific pattern (see Section <a href="intro.html#fileswd">1.8</a>. Read all CSV files in your working directory (or elsewhere) into a single list, and count the number of rows for each dataframe.
</div>

<p>Finally, we can use <code>lapply</code> to do all sorts of complex analyses that return any kind of object. The use of <code>lapply</code> with lists ensures that we can organize even large amounts of data in this way.</p>
<p>Let’s do a simple linear regression of log(leafarea) on log(diameter) for the Allometry dataset, by species:</p>
<div class="sourceCode" id="cb630"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb630-1"><a href="programming.html#cb630-1"></a><span class="co"># Run the linear regression on each element of the list, store in a new object:</span></span>
<span id="cb630-2"><a href="programming.html#cb630-2"></a>lmresults &lt;-<span class="st"> </span><span class="kw">lapply</span>(allomsp, <span class="cf">function</span>(x)<span class="kw">lm</span>(<span class="kw">log10</span>(leafarea) <span class="op">~</span><span class="st"> </span><span class="kw">log10</span>(diameter), <span class="dt">data=</span>x))</span>
<span id="cb630-3"><a href="programming.html#cb630-3"></a></span>
<span id="cb630-4"><a href="programming.html#cb630-4"></a><span class="co"># Now, lmresults is itself a list (where each element is an object as returned by lm)</span></span>
<span id="cb630-5"><a href="programming.html#cb630-5"></a><span class="co"># We can extract the coefficients like this:</span></span>
<span id="cb630-6"><a href="programming.html#cb630-6"></a><span class="kw">sapply</span>(lmresults, coef)</span></code></pre></div>
<pre><code>##                       PIMO       PIPO       PSME
## (Intercept)     -0.3570268 -0.7368336 -0.3135996
## log10(diameter)  1.5408859  1.6427773  1.4841361</code></pre>
<div class="sourceCode" id="cb632"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb632-1"><a href="programming.html#cb632-1"></a><span class="co"># This shows the intercept and slope by species.</span></span>
<span id="cb632-2"><a href="programming.html#cb632-2"></a><span class="co"># Also look at (results not shown):</span></span>
<span id="cb632-3"><a href="programming.html#cb632-3"></a><span class="co"># lapply(lmresults, summary) </span></span>
<span id="cb632-4"><a href="programming.html#cb632-4"></a></span>
<span id="cb632-5"><a href="programming.html#cb632-5"></a><span class="co"># Get R2 for each model. First write a function that extracts it.</span></span>
<span id="cb632-6"><a href="programming.html#cb632-6"></a>getR2 &lt;-<span class="st"> </span><span class="cf">function</span>(x)<span class="kw">summary</span>(x)<span class="op">$</span>adj.r.squared</span>
<span id="cb632-7"><a href="programming.html#cb632-7"></a><span class="kw">sapply</span>(lmresults, getR2)</span></code></pre></div>
<pre><code>##      PIMO      PIPO      PSME 
## 0.8738252 0.8441844 0.6983126</code></pre>

<div class="rmdtry">
Try to fully understand the difference between <code>sapply</code> and <code>lapply</code> by using <code>lapply</code> in some of the examples where we used <code>sapply</code> (and vice versa).
</div>

</div>
</div>
</div>
<div id="simpleloops" class="section level2">
<h2><span class="header-section-number">4.4</span> Loops</h2>
<p>Loops can be useful when we need to repeat certain analyses many times, and it is difficult to achieve this with <code>lapply</code> or <code>sapply</code>. To understand how a <code>for</code> loop works, look at this example:</p>
<div class="sourceCode" id="cb634"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb634-1"><a href="programming.html#cb634-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>){</span>
<span id="cb634-2"><a href="programming.html#cb634-2"></a>  <span class="kw">message</span>(i)</span>
<span id="cb634-3"><a href="programming.html#cb634-3"></a>}</span></code></pre></div>
<pre><code>## 1</code></pre>
<pre><code>## 2</code></pre>
<pre><code>## 3</code></pre>
<pre><code>## 4</code></pre>
<pre><code>## 5</code></pre>
<p>Here, the bit of code between {} is executed five times, and the object <code>i</code> has the values 1,2,3,4 and 5, in that order. Instead of just printing <code>i</code> as we have done above, we can also index a vector with this object:</p>
<div class="sourceCode" id="cb640"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb640-1"><a href="programming.html#cb640-1"></a><span class="co"># make a vector</span></span>
<span id="cb640-2"><a href="programming.html#cb640-2"></a>myvec &lt;-<span class="st"> </span><span class="kw">round</span>(<span class="kw">runif</span>(<span class="dv">5</span>),<span class="dv">1</span>)</span>
<span id="cb640-3"><a href="programming.html#cb640-3"></a></span>
<span id="cb640-4"><a href="programming.html#cb640-4"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(myvec)){</span>
<span id="cb640-5"><a href="programming.html#cb640-5"></a>  <span class="kw">message</span>(<span class="st">&quot;Element &quot;</span>, i, <span class="st">&quot; of the vector is: &quot;</span>, myvec[i])</span>
<span id="cb640-6"><a href="programming.html#cb640-6"></a>}</span></code></pre></div>
<pre><code>## Element 1 of the vector is: 0.1</code></pre>
<pre><code>## Element 2 of the vector is: 0.8</code></pre>
<pre><code>## Element 3 of the vector is: 0</code></pre>
<pre><code>## Element 4 of the vector is: 0.4</code></pre>
<pre><code>## Element 5 of the vector is: 0.6</code></pre>
<p>Note that this is only a toy example: the same result can be achieved by simply typing <code>myvec</code>.</p>
<p>One common application of <code>for</code> loops in R arises when producing multiple plots in a <code>pdf</code>.
Consider this template (make your own working example based on any dataset).</p>
<p>We assume here you have a dataframe called ‘dataset’ with a <em>factor</em> ‘species’, for which you want to create separate plots of Y vs. X.</p>
<div class="sourceCode" id="cb646"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb646-1"><a href="programming.html#cb646-1"></a><span class="kw">pdf</span>(<span class="st">&quot;somefilename.pdf&quot;</span>, <span class="dt">onefile=</span><span class="ot">TRUE</span>)</span>
<span id="cb646-2"><a href="programming.html#cb646-2"></a><span class="cf">for</span>(lev <span class="cf">in</span> <span class="kw">levels</span>(dataset<span class="op">$</span>species)){</span>
<span id="cb646-3"><a href="programming.html#cb646-3"></a>  </span>
<span id="cb646-4"><a href="programming.html#cb646-4"></a>  <span class="kw">with</span>(<span class="kw">subset</span>(dataset, species<span class="op">==</span>lev),</span>
<span id="cb646-5"><a href="programming.html#cb646-5"></a>       <span class="kw">plot</span>(X,Y, </span>
<span id="cb646-6"><a href="programming.html#cb646-6"></a>            <span class="dt">main=</span><span class="kw">as.character</span>(lev)))</span>
<span id="cb646-7"><a href="programming.html#cb646-7"></a>}</span>
<span id="cb646-8"><a href="programming.html#cb646-8"></a><span class="kw">dev.off</span>()</span></code></pre></div>
<p>Here, we have to call <code>dev.off()</code> to close the pdf. This sort of use of <code>dev.off()</code> after a block of code is dangerous, instead use the approach outlined in Section <a href="programming.html#onexit">4.6.4</a> and place the code inside a function.</p>
<div id="better-indexing" class="section level3">
<h3><span class="header-section-number">4.4.1</span> Better indexing</h3>
<p>In the first example with <code>for</code> loops, we used <code>1:length(myvec)</code> to make <em>indices</em> for the for loop. This is fine when you know for sure <code>myvec</code> exists and isn’t <code>NULL</code> or <code>NA</code> (in which case the indices will not be what you expect - try it out!).</p>
<p>A safer alternative in <code>for</code> loops is to use <code>seq_along</code> like in the following example. Here we substitute different parts of a string using a <code>for</code> loop.</p>
<div class="sourceCode" id="cb647"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb647-1"><a href="programming.html#cb647-1"></a>mystring &lt;-<span class="st"> &quot;A fish called Wanda&quot;</span></span>
<span id="cb647-2"><a href="programming.html#cb647-2"></a></span>
<span id="cb647-3"><a href="programming.html#cb647-3"></a>replacements &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;fish&quot;</span>,<span class="st">&quot;called&quot;</span>,<span class="st">&quot;Wanda&quot;</span>)</span>
<span id="cb647-4"><a href="programming.html#cb647-4"></a></span>
<span id="cb647-5"><a href="programming.html#cb647-5"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="kw">seq_along</span>(replacements)){</span>
<span id="cb647-6"><a href="programming.html#cb647-6"></a>  <span class="kw">print</span>(<span class="kw">gsub</span>(replacements[i], <span class="st">&quot;dog&quot;</span>, mystring))</span>
<span id="cb647-7"><a href="programming.html#cb647-7"></a>}</span></code></pre></div>
<pre><code>## [1] &quot;A dog called Wanda&quot;
## [1] &quot;A fish dog Wanda&quot;
## [1] &quot;A fish called dog&quot;</code></pre>
<p>Now, when you place code similar to the above in a more generic function, you don’t have to worry when <code>replacements</code> is empty for some reason, the <code>for</code> loop will simply be skipped.</p>
</div>
</div>
<div id="functionsadvanced" class="section level2">
<h2><span class="header-section-number">4.5</span> Functions : advanced concepts</h2>
<div id="why-should-i-write-more-functions" class="section level3">
<h3><span class="header-section-number">4.5.1</span> Why should I write more functions?</h3>
<p>Organizing your complex work flow into many custom functions, instead of long scripts with just the raw code, has some key advantanges:</p>
<ul>
<li><p>Using functions makes it clear what the <strong>inputs</strong> are, and what are the <strong>outputs</strong>. For example, if you run <code>result &lt;- myfunction(mydata)</code>, you know that <code>mydata</code> was used to create <code>result</code>. Instead, if you place all your code <em>plain</em> in a script and use <code>source("myscript.R")</code>, what objects are created? Are there any output? If so, where? Using functions this way allows a logical flow of your scripts.</p></li>
<li><p>Using functions is much <strong>safer</strong> because objects created in the body of the function when it is executed only <em>live</em> for as long as the function is running (in the <strong>function scope</strong>). Once the function <em>returns</em> a result, all objects inside the function become cease to exist (see <a href="http://adv-r.had.co.nz/memory.html">Memory (Advanced R) by Hadley Wickham</a>). This means the objects do not use memory, and cannot cause conflicts with other objects in the session.</p></li>
<li><p>Using functions allows you to <strong>avoid any duplicated code</strong>. Duplicated code is terrible because when you want to modify your code, you have to repeat the modification (and remember where!). As a rule of thumb, if you do something 3 times, you should write a function. This function can also take some arguments, allowing it to do slightly different operations from different calls.</p></li>
<li><p>For different projects, you often find yourself using the same bits of code, for example to read certain data, format a certain table, or make some plot. It quickly makes sense to collect this sort of code into a collection of your own functions. When these functions become <strong>generic</strong> enough (applicable in many projects), you should consider bundling them in an R package.</p></li>
</ul>
</div>
<div id="wrapfunctions" class="section level3">
<h3><span class="header-section-number">4.5.2</span> Wrapper functions</h3>
<p>We often need to write simple functions that adjust one or two arguments to other functions. For example, suppose we often make plots with filled circles, with our favorite color (“dimgrey”) :</p>
<div class="sourceCode" id="cb649"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb649-1"><a href="programming.html#cb649-1"></a><span class="kw">library</span>(lgrdata)</span>
<span id="cb649-2"><a href="programming.html#cb649-2"></a><span class="kw">data</span>(howell)</span>
<span id="cb649-3"><a href="programming.html#cb649-3"></a><span class="kw">plot</span>(age, height, <span class="dt">data=</span>howell, <span class="dt">pch=</span><span class="dv">19</span>, <span class="dt">col=</span><span class="st">&quot;dimgrey&quot;</span>)</span></code></pre></div>
<p>We could of course <em>always</em> specify these arguments, or we can write a function that sets those defaults. It would look like the following, except this function is incomplete, since we have <em>hardcoded</em> the other plotting arguments (the dataset, and the x and y variables):</p>
<div class="sourceCode" id="cb650"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb650-1"><a href="programming.html#cb650-1"></a><span class="co"># This function is not how we want it yet!</span></span>
<span id="cb650-2"><a href="programming.html#cb650-2"></a>plot_filled_grey &lt;-<span class="st"> </span><span class="cf">function</span>(){</span>
<span id="cb650-3"><a href="programming.html#cb650-3"></a>  <span class="kw">plot</span>(age, height, <span class="dt">data=</span>howell, <span class="dt">pch=</span><span class="dv">19</span>, <span class="dt">col=</span><span class="st">&quot;dimgrey&quot;</span>)</span>
<span id="cb650-4"><a href="programming.html#cb650-4"></a>}</span></code></pre></div>
<p>We would like to be able to call the function via <code>plot_filled_grey(age, height, data=howell)</code>, in other words all arguments to our <em>wrapper function</em> should be passed to the underlying function. We have a very handy utility in R to do this, the three dots (<code>...</code>) :</p>
<div class="sourceCode" id="cb651"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb651-1"><a href="programming.html#cb651-1"></a>plot_filled_grey &lt;-<span class="st"> </span><span class="cf">function</span>(...){</span>
<span id="cb651-2"><a href="programming.html#cb651-2"></a>  <span class="kw">plot</span>(..., <span class="dt">pch=</span><span class="dv">19</span>, <span class="dt">col=</span><span class="st">&quot;dimgrey&quot;</span>)</span>
<span id="cb651-3"><a href="programming.html#cb651-3"></a>}</span></code></pre></div>
<p>The function now works as intended. It can be further improved if we realize that the plotting color cannot be changed - it is always “dimgrey”. We want the <em>default</em> value to be “dimgrey”, but with an option to change it. This can be achieved like so,</p>
<div class="sourceCode" id="cb652"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb652-1"><a href="programming.html#cb652-1"></a>plot_filled_grey &lt;-<span class="st"> </span><span class="cf">function</span>(..., <span class="dt">col=</span><span class="st">&quot;dimgrey&quot;</span>){</span>
<span id="cb652-2"><a href="programming.html#cb652-2"></a>  <span class="kw">plot</span>(..., <span class="dt">pch=</span><span class="dv">19</span>, <span class="dt">col=</span>col)</span>
<span id="cb652-3"><a href="programming.html#cb652-3"></a>}</span></code></pre></div>
<p>Here, <code>col=col</code> sets the color in the call to <code>plot</code> with the default value specified in the wrapper function (“dimgrey”), but the user can also change it as usual.</p>

<div class="rmdtry">
Take the <code>plot_filled_grey</code> function above, test it on some data, and modify it so that the plotting symbol can also be changed, but has a default value of 19.
</div>

</div>
<div id="wrapper-functions-to-ggplot2-or-dplyr" class="section level3">
<h3><span class="header-section-number">4.5.3</span> Wrapper functions to <code>ggplot2</code> or <code>dplyr</code></h3>
<p>In the previous section we saw how to write wrapper functions, functions that change a few arguments to some other function. These sort of functions are very helpful because we can save a lot of space by reusing a certain template. Suppose we want to make a plot with <code>ggplot2</code>, a simple scatter plot. We can achieve this via (result not shown),</p>
<div class="sourceCode" id="cb653"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb653-1"><a href="programming.html#cb653-1"></a><span class="kw">data</span>(howell)</span>
<span id="cb653-2"><a href="programming.html#cb653-2"></a><span class="kw">library</span>(ggplot2)</span>
<span id="cb653-3"><a href="programming.html#cb653-3"></a></span>
<span id="cb653-4"><a href="programming.html#cb653-4"></a><span class="kw">ggplot</span>(howell, <span class="kw">aes</span>(<span class="dt">x =</span> weight, <span class="dt">y =</span> height)) <span class="op">+</span></span>
<span id="cb653-5"><a href="programming.html#cb653-5"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">size =</span> <span class="fl">0.8</span>, <span class="dt">col =</span> <span class="st">&quot;dimgrey&quot;</span>) <span class="op">+</span></span>
<span id="cb653-6"><a href="programming.html#cb653-6"></a><span class="st">  </span><span class="kw">stat_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;loess&quot;</span>, <span class="dt">span =</span> <span class="fl">0.7</span>, <span class="dt">col=</span><span class="st">&quot;black&quot;</span>)</span></code></pre></div>
<p>We already used quite a bit of code for this simple plot, but imagine you have set various other options, formatting changes, axis limits and so on - you end up with a lot of code for one plot. If we want to reuse the code for another plot, for two other variables from the same dataframe, copy-pasting the code and modifying leads to even more code.</p>
<p>Writing wrapper functions for <code>ggplot2</code> (or <code>dplyr</code>, see below, or many other cases) is more difficult because the arguments in the <code>ggplot2</code> code we want to change (height and weight) <em>are not quoted</em> - they are variables inside a dataframe (<code>howell</code> in our case).</p>
<p>Suppose we have defined somewhere (perhaps as arguments in a function) that the following two variables should be used for the plot:</p>
<div class="sourceCode" id="cb654"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb654-1"><a href="programming.html#cb654-1"></a>xvar &lt;-<span class="st"> &quot;weight&quot;</span></span>
<span id="cb654-2"><a href="programming.html#cb654-2"></a>yvar &lt;-<span class="st"> &quot;height&quot;</span></span></code></pre></div>
<p>If we use the same code as in the previous example, it does not work because the variable names need to be <em>not quoted</em>. The following (rather obscure) syntax converts the quoted variable name, to a variable to be found within the provided data.</p>
<div class="sourceCode" id="cb655"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb655-1"><a href="programming.html#cb655-1"></a><span class="kw">library</span>(lgrdata)</span>
<span id="cb655-2"><a href="programming.html#cb655-2"></a><span class="kw">data</span>(howell)</span>
<span id="cb655-3"><a href="programming.html#cb655-3"></a></span>
<span id="cb655-4"><a href="programming.html#cb655-4"></a><span class="kw">ggplot</span>(howell, <span class="kw">aes</span>(<span class="dt">x =</span> <span class="op">!!</span><span class="kw">sym</span>(xvar), <span class="dt">y =</span> <span class="op">!!</span><span class="kw">sym</span>(yvar))) <span class="op">+</span></span>
<span id="cb655-5"><a href="programming.html#cb655-5"></a><span class="kw">geom_point</span>(<span class="dt">size =</span> <span class="fl">0.8</span>, <span class="dt">col =</span> <span class="st">&quot;dimgrey&quot;</span>)</span></code></pre></div>
<p><img src="07-programming_files/figure-html/unnamed-chunk-36-1.svg" width="672" /></p>
<p>We can now write a wrapper function for a <code>ggplot2</code> plot. The same approach works for many other similar wrapper functions, for example around <code>dplyr</code> operations.</p>
<div class="sourceCode" id="cb656"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb656-1"><a href="programming.html#cb656-1"></a><span class="co"># Make a scatter plot with the howell data.</span></span>
<span id="cb656-2"><a href="programming.html#cb656-2"></a>plot_scatter_howell &lt;-<span class="st"> </span><span class="cf">function</span>(xcol, ycol){</span>
<span id="cb656-3"><a href="programming.html#cb656-3"></a>    <span class="kw">ggplot</span>(howell, <span class="kw">aes</span>(<span class="dt">x =</span> <span class="op">!!</span><span class="kw">sym</span>(xcol), <span class="dt">y =</span> <span class="op">!!</span><span class="kw">sym</span>(ycol))) <span class="op">+</span></span>
<span id="cb656-4"><a href="programming.html#cb656-4"></a><span class="st">    </span><span class="kw">geom_point</span>(<span class="dt">size =</span> <span class="fl">0.8</span>, <span class="dt">col =</span> <span class="st">&quot;dimgrey&quot;</span>)</span>
<span id="cb656-5"><a href="programming.html#cb656-5"></a>}</span>
<span id="cb656-6"><a href="programming.html#cb656-6"></a></span>
<span id="cb656-7"><a href="programming.html#cb656-7"></a><span class="co"># The function can be used with quoted names:</span></span>
<span id="cb656-8"><a href="programming.html#cb656-8"></a><span class="kw">plot_scatter_howell</span>(<span class="st">&quot;height&quot;</span>, <span class="st">&quot;weight&quot;</span>)</span></code></pre></div>
<p>To also pass the dataset as an argument (making the function more general), we do not have to use any special syntax, but can immediately set it as an argument. The special syntax only applies when we are looking for variables in a dataframe.</p>
<div class="sourceCode" id="cb657"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb657-1"><a href="programming.html#cb657-1"></a><span class="co"># Our function now also takes a dataset as an argument</span></span>
<span id="cb657-2"><a href="programming.html#cb657-2"></a>plot_scatter_howell2 &lt;-<span class="st"> </span><span class="cf">function</span>(xcol, ycol, dataset){</span>
<span id="cb657-3"><a href="programming.html#cb657-3"></a>  </span>
<span id="cb657-4"><a href="programming.html#cb657-4"></a>  <span class="kw">ggplot</span>(dataset, <span class="kw">aes</span>(<span class="dt">x =</span> <span class="op">!!</span><span class="kw">sym</span>(xvar), <span class="dt">y =</span> <span class="op">!!</span><span class="kw">sym</span>(yvar))) <span class="op">+</span></span>
<span id="cb657-5"><a href="programming.html#cb657-5"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">size =</span> <span class="fl">0.8</span>, <span class="dt">col =</span> <span class="st">&quot;dimgrey&quot;</span>)</span>
<span id="cb657-6"><a href="programming.html#cb657-6"></a>  </span>
<span id="cb657-7"><a href="programming.html#cb657-7"></a>}</span>
<span id="cb657-8"><a href="programming.html#cb657-8"></a></span>
<span id="cb657-9"><a href="programming.html#cb657-9"></a><span class="co"># We can use it as,</span></span>
<span id="cb657-10"><a href="programming.html#cb657-10"></a><span class="kw">plot_scatter_howell2</span>(<span class="st">&quot;height&quot;</span>, <span class="st">&quot;weight&quot;</span>, <span class="dt">dataset =</span> howell)</span></code></pre></div>
</div>
<div id="functions-that-take-vectors-as-input" class="section level3">
<h3><span class="header-section-number">4.5.4</span> Functions that take vectors as input</h3>
<p>Many functions in R are <em>vectorized</em>, which means you can send a <em>vector</em> as an argument and the function will be automatically evaluated for each element of the vector. For example:</p>
<div class="sourceCode" id="cb658"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb658-1"><a href="programming.html#cb658-1"></a><span class="co"># Count nr of characters in one string:</span></span>
<span id="cb658-2"><a href="programming.html#cb658-2"></a><span class="kw">nchar</span>(<span class="st">&quot;A sentence&quot;</span>)</span></code></pre></div>
<pre><code>## [1] 10</code></pre>
<div class="sourceCode" id="cb660"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb660-1"><a href="programming.html#cb660-1"></a><span class="co"># the first argument to nchar() is vectorized:</span></span>
<span id="cb660-2"><a href="programming.html#cb660-2"></a><span class="kw">nchar</span>(<span class="kw">c</span>(<span class="st">&quot;A sentence&quot;</span>, <span class="st">&quot;is&quot;</span>, <span class="st">&quot;useful&quot;</span>))</span></code></pre></div>
<pre><code>## [1] 10  2  6</code></pre>
<p>Not all functions are vectorized, and when you write your own more complex functions you will often run into situations where you would like an argument to be vectorized but run into difficulty.</p>
<p>Take the following example:</p>
<div class="sourceCode" id="cb662"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb662-1"><a href="programming.html#cb662-1"></a><span class="co"># A complex calculation. </span></span>
<span id="cb662-2"><a href="programming.html#cb662-2"></a><span class="co"># If x is less than &quot;change_val&quot; (default 5), </span></span>
<span id="cb662-3"><a href="programming.html#cb662-3"></a><span class="co"># return the product, otherwise the sum.</span></span>
<span id="cb662-4"><a href="programming.html#cb662-4"></a>multiplex &lt;-<span class="st"> </span><span class="cf">function</span>(x, <span class="dt">change_val =</span> <span class="dv">5</span>){</span>
<span id="cb662-5"><a href="programming.html#cb662-5"></a>  </span>
<span id="cb662-6"><a href="programming.html#cb662-6"></a>  <span class="cf">if</span>(x <span class="op">&lt;</span><span class="st"> </span>change_val){</span>
<span id="cb662-7"><a href="programming.html#cb662-7"></a>    <span class="kw">prod</span>(<span class="dv">1</span><span class="op">:</span>x)</span>
<span id="cb662-8"><a href="programming.html#cb662-8"></a>  } <span class="cf">else</span> {</span>
<span id="cb662-9"><a href="programming.html#cb662-9"></a>    <span class="kw">sum</span>(<span class="dv">1</span><span class="op">:</span>x)</span>
<span id="cb662-10"><a href="programming.html#cb662-10"></a>  }</span>
<span id="cb662-11"><a href="programming.html#cb662-11"></a>  </span>
<span id="cb662-12"><a href="programming.html#cb662-12"></a>}</span>
<span id="cb662-13"><a href="programming.html#cb662-13"></a></span>
<span id="cb662-14"><a href="programming.html#cb662-14"></a><span class="co"># This should give 4*3*2*1</span></span>
<span id="cb662-15"><a href="programming.html#cb662-15"></a><span class="kw">multiplex</span>(<span class="dv">4</span>)</span></code></pre></div>
<pre><code>## [1] 24</code></pre>
<p>A function like this is really only useful if it is vectorized over <code>x</code>, but it does not work as intended:</p>
<div class="sourceCode" id="cb664"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb664-1"><a href="programming.html#cb664-1"></a><span class="co"># The function is not vectorized over x:</span></span>
<span id="cb664-2"><a href="programming.html#cb664-2"></a><span class="kw">multiplex</span>(<span class="dt">x =</span> <span class="kw">c</span>(<span class="dv">4</span>,<span class="dv">8</span>))</span></code></pre></div>
<pre><code>## Warning in if (x &lt; change_val) {: the condition has length &gt; 1 and only the
## first element will be used</code></pre>
<pre><code>## Warning in 1:x: numerical expression has 2 elements: only the first used</code></pre>
<pre><code>## [1] 24</code></pre>
<div class="sourceCode" id="cb668"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb668-1"><a href="programming.html#cb668-1"></a><span class="co"># ... or change_val</span></span>
<span id="cb668-2"><a href="programming.html#cb668-2"></a><span class="kw">multiplex</span>(<span class="dt">x =</span> <span class="dv">5</span>, <span class="dt">change_val =</span> <span class="kw">c</span>(<span class="dv">4</span>,<span class="dv">6</span>))</span></code></pre></div>
<pre><code>## Warning in if (x &lt; change_val) {: the condition has length &gt; 1 and only the
## first element will be used</code></pre>
<pre><code>## [1] 15</code></pre>
<p>You have at least 3 ways to vectorize any function. If you are only interested in vectorizing one argument at a time, you can use <code>sapply</code> as we have seen before:</p>
<div class="sourceCode" id="cb671"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb671-1"><a href="programming.html#cb671-1"></a><span class="kw">sapply</span>(<span class="kw">c</span>(<span class="dv">4</span>,<span class="dv">8</span>), multiplex)</span></code></pre></div>
<pre><code>## [1] 24 36</code></pre>
<p>For more than one argument at a time you can use the flexible <code>mapply</code>, which allows us to specify the arguments to the function as vectors or lists:</p>
<div class="sourceCode" id="cb673"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb673-1"><a href="programming.html#cb673-1"></a><span class="co"># First call multiplex(x=4, change_val = 3), then </span></span>
<span id="cb673-2"><a href="programming.html#cb673-2"></a><span class="co"># multiplex(x=8, change_val = 7)</span></span>
<span id="cb673-3"><a href="programming.html#cb673-3"></a><span class="kw">mapply</span>(multiplex, <span class="dt">x =</span> <span class="kw">c</span>(<span class="dv">4</span>,<span class="dv">8</span>), <span class="dt">change_val =</span> <span class="kw">c</span>(<span class="dv">3</span>,<span class="dv">7</span>))</span></code></pre></div>
<pre><code>## [1] 10 36</code></pre>
<p>Using <code>mapply</code> you can write your own wrapper functions (<a href="programming.html#wrapfunctions">4.5.2</a>) quite easily. If this is too much work for you, consider using the rather magical <code>Vectorize</code> (which really is itself a wrapper around <code>mapply</code>):</p>
<div class="sourceCode" id="cb675"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb675-1"><a href="programming.html#cb675-1"></a>multiplex2 &lt;-<span class="st"> </span><span class="kw">Vectorize</span>(multiplex)</span>
<span id="cb675-2"><a href="programming.html#cb675-2"></a><span class="kw">multiplex2</span>(<span class="kw">c</span>(<span class="dv">4</span>,<span class="dv">8</span>))</span></code></pre></div>
<pre><code>## [1] 24 36</code></pre>
<p>Inspect <code>?Vectorize</code> to find that you can specify which arguments will be vectorized, and whether to <em>simplify</em> the result (which works akin to <code>sapply</code>, making a vector or a matrix of a result where possible).</p>
<p>A final option is to write a <em>recursive</em> function that wraps around itself, executing the function once when the argument is not vectorized, and otherwise using <code>sapply</code> or <code>mapply</code> to return a vector of results:</p>
<div class="sourceCode" id="cb677"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb677-1"><a href="programming.html#cb677-1"></a>multiplex3 &lt;-<span class="st"> </span><span class="cf">function</span>(x, <span class="dt">change_val =</span> <span class="dv">5</span>){</span>
<span id="cb677-2"><a href="programming.html#cb677-2"></a>  </span>
<span id="cb677-3"><a href="programming.html#cb677-3"></a>  <span class="co"># Make the calculation when a single argument given:</span></span>
<span id="cb677-4"><a href="programming.html#cb677-4"></a>  <span class="cf">if</span>(<span class="kw">length</span>(x) <span class="op">==</span><span class="st"> </span><span class="dv">1</span>){</span>
<span id="cb677-5"><a href="programming.html#cb677-5"></a>    </span>
<span id="cb677-6"><a href="programming.html#cb677-6"></a>    <span class="cf">if</span>(x <span class="op">&lt;</span><span class="st"> </span>change_val){</span>
<span id="cb677-7"><a href="programming.html#cb677-7"></a>      <span class="kw">prod</span>(<span class="dv">1</span><span class="op">:</span>x)</span>
<span id="cb677-8"><a href="programming.html#cb677-8"></a>    } <span class="cf">else</span> {</span>
<span id="cb677-9"><a href="programming.html#cb677-9"></a>      <span class="kw">sum</span>(<span class="dv">1</span><span class="op">:</span>x)</span>
<span id="cb677-10"><a href="programming.html#cb677-10"></a>    }  </span>
<span id="cb677-11"><a href="programming.html#cb677-11"></a>    </span>
<span id="cb677-12"><a href="programming.html#cb677-12"></a>  } <span class="cf">else</span> {</span>
<span id="cb677-13"><a href="programming.html#cb677-13"></a>    </span>
<span id="cb677-14"><a href="programming.html#cb677-14"></a>    <span class="co"># Otherwise use mapply, each time calling *this function*,</span></span>
<span id="cb677-15"><a href="programming.html#cb677-15"></a>    <span class="co"># recursively.</span></span>
<span id="cb677-16"><a href="programming.html#cb677-16"></a>    <span class="kw">mapply</span>(multiplex3, <span class="dt">x =</span> x, <span class="dt">change_val =</span> change_val)</span>
<span id="cb677-17"><a href="programming.html#cb677-17"></a>  }</span>
<span id="cb677-18"><a href="programming.html#cb677-18"></a>  </span>
<span id="cb677-19"><a href="programming.html#cb677-19"></a>}</span>
<span id="cb677-20"><a href="programming.html#cb677-20"></a></span>
<span id="cb677-21"><a href="programming.html#cb677-21"></a><span class="kw">multiplex3</span>(<span class="kw">c</span>(<span class="dv">4</span>,<span class="dv">8</span>))</span></code></pre></div>
<pre><code>## [1] 24 36</code></pre>
<p>This final solution can be found in many base R functions, and is a flexible - but more advanced - interface to allow vectorized arguments.</p>
</div>
<div id="if-then-else-switch" class="section level3">
<h3><span class="header-section-number">4.5.5</span> If, then, else … switch</h3>
<p>We have already seen the basic <code>if</code> statement in many examples, which can be extended with multiple <code>else if</code> statements:</p>
<div class="sourceCode" id="cb679"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb679-1"><a href="programming.html#cb679-1"></a><span class="co"># NOT an elegant use of multiple if statements.</span></span>
<span id="cb679-2"><a href="programming.html#cb679-2"></a>animal_weight &lt;-<span class="st"> </span><span class="cf">function</span>(animal){</span>
<span id="cb679-3"><a href="programming.html#cb679-3"></a>  </span>
<span id="cb679-4"><a href="programming.html#cb679-4"></a>  <span class="cf">if</span>(animal <span class="op">==</span><span class="st"> &quot;cat&quot;</span>){</span>
<span id="cb679-5"><a href="programming.html#cb679-5"></a>    weight &lt;-<span class="st"> </span><span class="dv">10</span></span>
<span id="cb679-6"><a href="programming.html#cb679-6"></a>  } <span class="cf">else</span> <span class="cf">if</span>(animal <span class="op">==</span><span class="st"> &quot;cow&quot;</span>){</span>
<span id="cb679-7"><a href="programming.html#cb679-7"></a>    weight &lt;-<span class="st"> </span><span class="dv">1000</span></span>
<span id="cb679-8"><a href="programming.html#cb679-8"></a>  } <span class="cf">else</span> <span class="cf">if</span>(animal <span class="op">==</span><span class="st"> &quot;mouse&quot;</span>){</span>
<span id="cb679-9"><a href="programming.html#cb679-9"></a>    weight &lt;-<span class="st"> </span><span class="dv">1</span></span>
<span id="cb679-10"><a href="programming.html#cb679-10"></a>  } <span class="cf">else</span> <span class="cf">if</span>(animal <span class="op">==</span><span class="st"> &quot;dog&quot;</span>){</span>
<span id="cb679-11"><a href="programming.html#cb679-11"></a>    weight &lt;-<span class="st"> </span><span class="dv">20</span></span>
<span id="cb679-12"><a href="programming.html#cb679-12"></a>  }</span>
<span id="cb679-13"><a href="programming.html#cb679-13"></a>  </span>
<span id="cb679-14"><a href="programming.html#cb679-14"></a><span class="kw">return</span>(weight)</span>
<span id="cb679-15"><a href="programming.html#cb679-15"></a>}</span>
<span id="cb679-16"><a href="programming.html#cb679-16"></a></span>
<span id="cb679-17"><a href="programming.html#cb679-17"></a></span>
<span id="cb679-18"><a href="programming.html#cb679-18"></a><span class="kw">animal_weight</span>(<span class="st">&quot;dog&quot;</span>)</span></code></pre></div>
<pre><code>## [1] 20</code></pre>
<p>The use of many <code>if</code> statements like this cause a lot of repetitive code. Usually if you have many <code>if then else</code> statements, you can either think of a simpler design for your function, or you can use <code>switch</code> where appropriate:</p>
<div class="sourceCode" id="cb681"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb681-1"><a href="programming.html#cb681-1"></a>animal_weight &lt;-<span class="st"> </span><span class="cf">function</span>(animal){</span>
<span id="cb681-2"><a href="programming.html#cb681-2"></a>  </span>
<span id="cb681-3"><a href="programming.html#cb681-3"></a>  </span>
<span id="cb681-4"><a href="programming.html#cb681-4"></a>  weight &lt;-<span class="st"> </span><span class="cf">switch</span>(animal, </span>
<span id="cb681-5"><a href="programming.html#cb681-5"></a>                   <span class="dt">mouse =</span> <span class="dv">1</span>,</span>
<span id="cb681-6"><a href="programming.html#cb681-6"></a>                   <span class="dt">cat =</span> <span class="dv">10</span>,</span>
<span id="cb681-7"><a href="programming.html#cb681-7"></a>                   <span class="dt">dog =</span> <span class="dv">20</span>,</span>
<span id="cb681-8"><a href="programming.html#cb681-8"></a>                   <span class="dt">cow =</span> <span class="dv">1000</span>,</span>
<span id="cb681-9"><a href="programming.html#cb681-9"></a>                   <span class="ot">NA</span>)  <span class="co"># Return NA if the animal is not one of those above</span></span>
<span id="cb681-10"><a href="programming.html#cb681-10"></a>                   </span>
<span id="cb681-11"><a href="programming.html#cb681-11"></a><span class="kw">return</span>(weight)</span>
<span id="cb681-12"><a href="programming.html#cb681-12"></a>}</span></code></pre></div>
<p>Here <code>switch</code> improves the readability of the code a lot. If you want to <em>switch</em> a numeric input, <code>switch</code> is perhaps not the best solution.</p>
<p>If you find yourself writing code like this:</p>
<div class="sourceCode" id="cb682"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb682-1"><a href="programming.html#cb682-1"></a><span class="co"># An input value</span></span>
<span id="cb682-2"><a href="programming.html#cb682-2"></a>num &lt;-<span class="st"> </span><span class="dv">3</span></span>
<span id="cb682-3"><a href="programming.html#cb682-3"></a></span>
<span id="cb682-4"><a href="programming.html#cb682-4"></a><span class="co"># DO NOT do this.</span></span>
<span id="cb682-5"><a href="programming.html#cb682-5"></a><span class="cf">switch</span>(<span class="kw">as.character</span>(num),</span>
<span id="cb682-6"><a href="programming.html#cb682-6"></a>       <span class="st">&quot;1&quot;</span> =<span class="st"> &quot;Door number one.&quot;</span>,</span>
<span id="cb682-7"><a href="programming.html#cb682-7"></a>       <span class="st">&quot;2&quot;</span> =<span class="st"> &quot;Door number two.&quot;</span>,</span>
<span id="cb682-8"><a href="programming.html#cb682-8"></a>       <span class="st">&quot;3&quot;</span> =<span class="st"> &quot;Door number three.&quot;</span></span>
<span id="cb682-9"><a href="programming.html#cb682-9"></a>       )</span></code></pre></div>
<pre><code>## [1] &quot;Door number three.&quot;</code></pre>
<p>Then you are overthinking this! The above can be accomplished with basic indexing:</p>
<div class="sourceCode" id="cb684"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb684-1"><a href="programming.html#cb684-1"></a>num &lt;-<span class="st"> </span><span class="dv">3</span></span>
<span id="cb684-2"><a href="programming.html#cb684-2"></a></span>
<span id="cb684-3"><a href="programming.html#cb684-3"></a>door_options &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;Door number &quot;</span>, <span class="kw">c</span>(<span class="st">&quot;one&quot;</span>,<span class="st">&quot;two&quot;</span>,<span class="st">&quot;three&quot;</span>), <span class="st">&quot;.&quot;</span>)</span>
<span id="cb684-4"><a href="programming.html#cb684-4"></a></span>
<span id="cb684-5"><a href="programming.html#cb684-5"></a>door_options[num]</span></code></pre></div>
<pre><code>## [1] &quot;Door number three.&quot;</code></pre>

<div class="rmdtry">
Write the previous example as a custom R function that takes <code>num</code> as an argument, and the noun (here, “Door”) as an optional second argument with a default value.
</div>

</div>
</div>
<div id="defensive" class="section level2">
<h2><span class="header-section-number">4.6</span> Robust functions: defensive programming</h2>
<p>Once you write more functions that perhaps become more generic and widely applicable within your projects, you want these functions to be more robust, that is, to fail less often and more elegantly. Functions fail if the wrong inputs were provided to them (by a careless programmer or data faults), or if some (rare) exception is reached. In this section we will look at a few tools to help you write more robust functions.</p>
<div id="argument-matching" class="section level3">
<h3><span class="header-section-number">4.6.1</span> Argument matching</h3>
<p>Returning to our <code>animal_weight</code> function from the previous section,</p>
<div class="sourceCode" id="cb686"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb686-1"><a href="programming.html#cb686-1"></a><span class="co"># A slightly shorter version of animal_weight().</span></span>
<span id="cb686-2"><a href="programming.html#cb686-2"></a>animal_weight &lt;-<span class="st"> </span><span class="cf">function</span>(animal){</span>
<span id="cb686-3"><a href="programming.html#cb686-3"></a>  <span class="cf">switch</span>(animal, </span>
<span id="cb686-4"><a href="programming.html#cb686-4"></a>             <span class="dt">mouse =</span> <span class="dv">1</span>,</span>
<span id="cb686-5"><a href="programming.html#cb686-5"></a>             <span class="dt">cat =</span> <span class="dv">10</span>,</span>
<span id="cb686-6"><a href="programming.html#cb686-6"></a>             <span class="dt">dog =</span> <span class="dv">20</span>,</span>
<span id="cb686-7"><a href="programming.html#cb686-7"></a>             <span class="dt">cow =</span> <span class="dv">1000</span>,</span>
<span id="cb686-8"><a href="programming.html#cb686-8"></a>             <span class="ot">NA</span>)</span>
<span id="cb686-9"><a href="programming.html#cb686-9"></a>              </span>
<span id="cb686-10"><a href="programming.html#cb686-10"></a>}</span></code></pre></div>
<p>Here the last argument to <code>switch</code> indicates the value to return if the animal does not match any of the above. What if instead we want the function to stop and return a message if the value of the argument is not supported by the function? We can use <code>match.arg</code>, as follows:</p>
<div class="sourceCode" id="cb687"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb687-1"><a href="programming.html#cb687-1"></a><span class="co"># Define animal_weight2 as a function which only allows 4 types of animal:</span></span>
<span id="cb687-2"><a href="programming.html#cb687-2"></a>animal_weight2 &lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">animal =</span> <span class="kw">c</span>(<span class="st">&quot;mouse&quot;</span>,<span class="st">&quot;cat&quot;</span>,<span class="st">&quot;dog&quot;</span>,<span class="st">&quot;cow&quot;</span>)){</span>
<span id="cb687-3"><a href="programming.html#cb687-3"></a>  </span>
<span id="cb687-4"><a href="programming.html#cb687-4"></a>  animal &lt;-<span class="st"> </span><span class="kw">match.arg</span>(animal)</span>
<span id="cb687-5"><a href="programming.html#cb687-5"></a>  </span>
<span id="cb687-6"><a href="programming.html#cb687-6"></a>  <span class="cf">switch</span>(animal, </span>
<span id="cb687-7"><a href="programming.html#cb687-7"></a>             <span class="dt">mouse =</span> <span class="dv">1</span>,</span>
<span id="cb687-8"><a href="programming.html#cb687-8"></a>             <span class="dt">cat =</span> <span class="dv">10</span>,</span>
<span id="cb687-9"><a href="programming.html#cb687-9"></a>             <span class="dt">dog =</span> <span class="dv">20</span>,</span>
<span id="cb687-10"><a href="programming.html#cb687-10"></a>             <span class="dt">cow =</span> <span class="dv">1000</span>)</span>
<span id="cb687-11"><a href="programming.html#cb687-11"></a>              </span>
<span id="cb687-12"><a href="programming.html#cb687-12"></a>}</span>
<span id="cb687-13"><a href="programming.html#cb687-13"></a></span>
<span id="cb687-14"><a href="programming.html#cb687-14"></a><span class="co"># Now see what happens when we give a wrong animal:</span></span>
<span id="cb687-15"><a href="programming.html#cb687-15"></a><span class="kw">animal_weight2</span>(<span class="st">&quot;giraffe&quot;</span>)</span></code></pre></div>
<p>The output of the above will be:</p>
<pre><code>Error in match.arg(animal) : 
  &#39;arg&#39; should be one of &quot;mouse&quot;, &quot;cat&quot;, &quot;dog&quot;, &quot;cow&quot;</code></pre>
<p>Using <code>match.arg</code> resulted in a <em>very clear error message</em>. This sort of message makes it easy to find the source of the error.</p>
<p>A side-effect of using <code>match.arg</code> is that it performs <em>partial matching</em>, meaning you can also call the function with only part of the argument value, for example try <code>animal_weight("mo")</code>. Personally I dislike partial matching as it rarely benefits us, but can cause problems that are hard to find. Probably best to not rely on it in any real code, though it can help save a few key strokes.</p>
</div>
<div id="argument-checking" class="section level3">
<h3><span class="header-section-number">4.6.2</span> Argument checking</h3>
<p>Many functions expect a certain argument type, and make no sense or will fail when other argument types are provided. The function below make a sentence into sentence case, with the first letter of each word capitalized.</p>
<div class="sourceCode" id="cb689"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb689-1"><a href="programming.html#cb689-1"></a>sentence_case &lt;-<span class="st"> </span><span class="cf">function</span>(x){</span>
<span id="cb689-2"><a href="programming.html#cb689-2"></a>  </span>
<span id="cb689-3"><a href="programming.html#cb689-3"></a>  <span class="kw">stopifnot</span>(<span class="kw">is.character</span>(x))</span>
<span id="cb689-4"><a href="programming.html#cb689-4"></a>  </span>
<span id="cb689-5"><a href="programming.html#cb689-5"></a>  w &lt;-<span class="st"> </span><span class="kw">sapply</span>(<span class="kw">strsplit</span>(x, <span class="st">&quot; &quot;</span>), <span class="cf">function</span>(ch){</span>
<span id="cb689-6"><a href="programming.html#cb689-6"></a>    <span class="kw">substr</span>(ch,<span class="dv">1</span>,<span class="dv">1</span>) &lt;-<span class="st"> </span><span class="kw">toupper</span>(<span class="kw">substr</span>(ch,<span class="dv">1</span>,<span class="dv">1</span>))  </span>
<span id="cb689-7"><a href="programming.html#cb689-7"></a>    <span class="kw">return</span>(ch)</span>
<span id="cb689-8"><a href="programming.html#cb689-8"></a>  })</span>
<span id="cb689-9"><a href="programming.html#cb689-9"></a>  </span>
<span id="cb689-10"><a href="programming.html#cb689-10"></a>  <span class="kw">paste</span>(w, <span class="dt">collapse =</span> <span class="st">&quot; &quot;</span>)</span>
<span id="cb689-11"><a href="programming.html#cb689-11"></a>  </span>
<span id="cb689-12"><a href="programming.html#cb689-12"></a>}</span></code></pre></div>
<p>Now this function call works fine,</p>
<div class="sourceCode" id="cb690"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb690-1"><a href="programming.html#cb690-1"></a><span class="kw">sentence_case</span>(<span class="st">&quot;breaking news: man arrested for everything&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;Breaking News: Man Arrested For Everything&quot;</code></pre>
<div class="sourceCode" id="cb692"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb692-1"><a href="programming.html#cb692-1"></a><span class="kw">sentence_case</span>(<span class="dv">100</span>)</span></code></pre></div>
<p>But this one does not (try it out yourself!).</p>
</div>
<div id="sending-warnings-errors-messages" class="section level3">
<h3><span class="header-section-number">4.6.3</span> Sending warnings, errors, messages</h3>
<p>In more complex projects, it can be difficult to find which part of your code caused an error or unexpected result. Leaving useful messages, warnings, or exiting when you know things will go wrong later can be very useful in developing more debuggable code.</p>
<div class="sourceCode" id="cb693"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb693-1"><a href="programming.html#cb693-1"></a>example_function_warnings &lt;-<span class="st"> </span><span class="cf">function</span>(data){</span>
<span id="cb693-2"><a href="programming.html#cb693-2"></a>  </span>
<span id="cb693-3"><a href="programming.html#cb693-3"></a>  <span class="kw">stopifnot</span>(<span class="kw">is.vector</span>(data))</span>
<span id="cb693-4"><a href="programming.html#cb693-4"></a>  </span>
<span id="cb693-5"><a href="programming.html#cb693-5"></a>  <span class="cf">if</span>(<span class="kw">length</span>(data) <span class="op">&gt;</span><span class="st"> </span><span class="dv">1000</span>){</span>
<span id="cb693-6"><a href="programming.html#cb693-6"></a>    <span class="kw">warning</span>(<span class="st">&quot;This might take a while!&quot;</span>)</span>
<span id="cb693-7"><a href="programming.html#cb693-7"></a>  }</span>
<span id="cb693-8"><a href="programming.html#cb693-8"></a>  </span>
<span id="cb693-9"><a href="programming.html#cb693-9"></a>  <span class="cf">if</span>(<span class="kw">length</span>(data) <span class="op">==</span><span class="st"> </span><span class="dv">0</span>){</span>
<span id="cb693-10"><a href="programming.html#cb693-10"></a>    <span class="kw">stop</span>(<span class="st">&quot;Data is empty&quot;</span>)</span>
<span id="cb693-11"><a href="programming.html#cb693-11"></a>  }</span>
<span id="cb693-12"><a href="programming.html#cb693-12"></a>  </span>
<span id="cb693-13"><a href="programming.html#cb693-13"></a>  <span class="cf">if</span>(<span class="kw">all</span>(<span class="kw">is.na</span>(data))){</span>
<span id="cb693-14"><a href="programming.html#cb693-14"></a>    <span class="kw">message</span>(<span class="st">&quot;Only missing data sent to example_function_warnings()&quot;</span>)</span>
<span id="cb693-15"><a href="programming.html#cb693-15"></a>  }</span>
<span id="cb693-16"><a href="programming.html#cb693-16"></a>  </span>
<span id="cb693-17"><a href="programming.html#cb693-17"></a>  <span class="co"># actually do something</span></span>
<span id="cb693-18"><a href="programming.html#cb693-18"></a>  <span class="co"># ...</span></span>
<span id="cb693-19"><a href="programming.html#cb693-19"></a>}</span></code></pre></div>
<p>The use of <code>message</code> is nice to provide some indication to you where code was executed. Scattering a messages around your code (with an indication where we are in the code) can be invaluable during development of more complex projects, with lots of functions.</p>
<p>Sometimes you want <em>fewer</em> warnings or messages, for example arising from code that works fine but always produces an annoying warning. You can switch them off with these two functions:</p>
<div class="sourceCode" id="cb694"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb694-1"><a href="programming.html#cb694-1"></a><span class="kw">suppressMessages</span>({</span>
<span id="cb694-2"><a href="programming.html#cb694-2"></a>  <span class="co"># code here that produces messages</span></span>
<span id="cb694-3"><a href="programming.html#cb694-3"></a>})</span></code></pre></div>
<pre><code>## NULL</code></pre>
<div class="sourceCode" id="cb696"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb696-1"><a href="programming.html#cb696-1"></a><span class="kw">suppressWarnings</span>({</span>
<span id="cb696-2"><a href="programming.html#cb696-2"></a>  <span class="co"># Code here with warnings you want to suppress.</span></span>
<span id="cb696-3"><a href="programming.html#cb696-3"></a>  <span class="co"># Don&#39;t use this unless you know what you are doing!</span></span>
<span id="cb696-4"><a href="programming.html#cb696-4"></a>})</span></code></pre></div>
<pre><code>## NULL</code></pre>
</div>
<div id="onexit" class="section level3">
<h3><span class="header-section-number">4.6.4</span> Executing code when the function ends (or fails)</h3>
<p>A useful tool to make functions more robust (less likely to fail) is to safely run some code when the function exits unexpectedly. One example arises with sending figures to an open PDF document: after we are done, the PDF needs to be closed with <code>dev.off()</code> (see Example in Section <a href="programming.html#simpleloops">4.4</a>).</p>
<p>In this example, we have written a function that makes a simple plot in a pdf:</p>
<div class="sourceCode" id="cb698"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb698-1"><a href="programming.html#cb698-1"></a><span class="co"># Plot first 2 columns of a dataset against each other, make a PDF.</span></span>
<span id="cb698-2"><a href="programming.html#cb698-2"></a>plot_first_<span class="dv">2</span>_columns &lt;-<span class="st"> </span><span class="cf">function</span>(data, <span class="dt">output =</span> <span class="st">&quot;plot.pdf&quot;</span>){</span>
<span id="cb698-3"><a href="programming.html#cb698-3"></a>  </span>
<span id="cb698-4"><a href="programming.html#cb698-4"></a>  <span class="kw">pdf</span>(output)</span>
<span id="cb698-5"><a href="programming.html#cb698-5"></a>  <span class="kw">plot</span>(data[[<span class="dv">1</span>]], data[[<span class="dv">2</span>]])</span>
<span id="cb698-6"><a href="programming.html#cb698-6"></a>  <span class="kw">dev.off</span>()</span>
<span id="cb698-7"><a href="programming.html#cb698-7"></a>  </span>
<span id="cb698-8"><a href="programming.html#cb698-8"></a>}</span></code></pre></div>
<p>This is OK, but what if we send a dataset with just one column, or some other corrupted data or wrong argument? The pdf will be opened but not closed, because <code>plot(data...)</code> will cause an error, causing the function to exit (and not run the rest of the code).</p>
<p>A better implementation uses <code>on.exit</code>, like so:</p>
<div class="sourceCode" id="cb699"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb699-1"><a href="programming.html#cb699-1"></a><span class="co"># Plot first 2 columns of a dataset against each other, make a PDF.</span></span>
<span id="cb699-2"><a href="programming.html#cb699-2"></a>plot_first_<span class="dv">2</span>_columns &lt;-<span class="st"> </span><span class="cf">function</span>(data, <span class="dt">output =</span> <span class="st">&quot;plot.pdf&quot;</span>){</span>
<span id="cb699-3"><a href="programming.html#cb699-3"></a>  </span>
<span id="cb699-4"><a href="programming.html#cb699-4"></a>  <span class="kw">pdf</span>(output)</span>
<span id="cb699-5"><a href="programming.html#cb699-5"></a>  <span class="kw">on.exit</span>(<span class="kw">dev.off</span>())</span>
<span id="cb699-6"><a href="programming.html#cb699-6"></a>  </span>
<span id="cb699-7"><a href="programming.html#cb699-7"></a>  <span class="kw">plot</span>(data[[<span class="dv">1</span>]], data[[<span class="dv">2</span>]])</span>
<span id="cb699-8"><a href="programming.html#cb699-8"></a>  </span>
<span id="cb699-9"><a href="programming.html#cb699-9"></a>}</span></code></pre></div>
</div>
<div id="try" class="section level3">
<h3><span class="header-section-number">4.6.5</span> Catch errors with <code>try</code></h3>
<p>The ultimate tool to make functions more robust is <code>try</code>, a mechanism to catch errors and avoid termination of your code.</p>
<p>First we show the use of <code>try</code>, a flexible interface, like so:</p>
<div class="sourceCode" id="cb700"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb700-1"><a href="programming.html#cb700-1"></a><span class="co"># A wrapper around log(), avoiding an error when the input is bad,</span></span>
<span id="cb700-2"><a href="programming.html#cb700-2"></a><span class="co"># and instead returning a missing value.</span></span>
<span id="cb700-3"><a href="programming.html#cb700-3"></a>safe_logarithm &lt;-<span class="st"> </span><span class="cf">function</span>(x){</span>
<span id="cb700-4"><a href="programming.html#cb700-4"></a>  </span>
<span id="cb700-5"><a href="programming.html#cb700-5"></a>  out &lt;-<span class="st"> </span><span class="kw">try</span>(<span class="kw">log</span>(x))</span>
<span id="cb700-6"><a href="programming.html#cb700-6"></a>  </span>
<span id="cb700-7"><a href="programming.html#cb700-7"></a>  <span class="co"># If log(x) caused an error, out will be a special </span></span>
<span id="cb700-8"><a href="programming.html#cb700-8"></a>  <span class="co"># object with class &#39;try-error&#39;</span></span>
<span id="cb700-9"><a href="programming.html#cb700-9"></a>  <span class="cf">if</span>(<span class="kw">inherits</span>(out, <span class="st">&quot;try-error&quot;</span>)){</span>
<span id="cb700-10"><a href="programming.html#cb700-10"></a>    </span>
<span id="cb700-11"><a href="programming.html#cb700-11"></a>    <span class="kw">return</span>(<span class="ot">NA</span>)</span>
<span id="cb700-12"><a href="programming.html#cb700-12"></a>    </span>
<span id="cb700-13"><a href="programming.html#cb700-13"></a>  }</span>
<span id="cb700-14"><a href="programming.html#cb700-14"></a>  </span>
<span id="cb700-15"><a href="programming.html#cb700-15"></a>out</span>
<span id="cb700-16"><a href="programming.html#cb700-16"></a>}</span></code></pre></div>
<p>Now <code>safe_logarithm("a")</code> returns <code>NA</code>, but you do see the error message printed (unless you look around <code>?try</code> for a way to suppress the error message).</p>
<p>The same thing can be achieved with <code>tryCatch</code> :</p>
<div class="sourceCode" id="cb701"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb701-1"><a href="programming.html#cb701-1"></a>x &lt;-<span class="st"> &quot;a&quot;</span></span>
<span id="cb701-2"><a href="programming.html#cb701-2"></a><span class="kw">tryCatch</span>(<span class="kw">log</span>(x), <span class="dt">error =</span> <span class="cf">function</span>(e)<span class="ot">NA</span>)</span></code></pre></div>
<pre><code>## [1] NA</code></pre>
<p>Here, we have to define a function (with argument <code>e</code>, which contains the error message) for the error. Similarly, functions can be defined that will be called when warnings arise in the code (<code>warning = function(w)w</code>), or neither (<code>finally</code>).</p>
</div>
<div id="dbiwrappers" class="section level3">
<h3><span class="header-section-number">4.6.6</span> Writing database wrapper functions</h3>
<p>This example combines various concepts from this section, and is a useful set of functions when you commonly work with databases. First review Section about the <code>DBI</code>package to access data from databases. The functions below will be developed step-by-step. Please carefully review this section if you want to adapt this code to your situation.</p>
<p>After we are done reading and writing to a (usually remote) database, the connection to it should be <em>closed</em> with <code>dbDisconnect</code> (in the DBI package). Sometimes we forget, or code fails, or whatever - leaving extra connections open that can cause various problems (especially in production-ready code).</p>
<p>The following example can be modified to suite your needs :</p>
<div class="sourceCode" id="cb703"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb703-1"><a href="programming.html#cb703-1"></a><span class="co"># A function to make a connection to your database</span></span>
<span id="cb703-2"><a href="programming.html#cb703-2"></a><span class="co"># Now, instead of copying this bit of code to all your scripts, you</span></span>
<span id="cb703-3"><a href="programming.html#cb703-3"></a><span class="co"># define the function once and run con &lt;- db_connection()</span></span>
<span id="cb703-4"><a href="programming.html#cb703-4"></a>db_connection &lt;-<span class="st"> </span><span class="cf">function</span>(){</span>
<span id="cb703-5"><a href="programming.html#cb703-5"></a>  DBI<span class="op">::</span><span class="kw">dbConnect</span>(<span class="dt">drv =</span> <span class="kw">PostgreSQL</span>(),</span>
<span id="cb703-6"><a href="programming.html#cb703-6"></a>                 <span class="dt">user =</span> <span class="st">&quot;mjvgsdzg&quot;</span>,</span>
<span id="cb703-7"><a href="programming.html#cb703-7"></a>                 <span class="dt">password =</span> <span class="st">&quot;my_password&quot;</span>,</span>
<span id="cb703-8"><a href="programming.html#cb703-8"></a>                 <span class="dt">host =</span> <span class="st">&quot;balarama.db.elephantsql.com&quot;</span>,</span>
<span id="cb703-9"><a href="programming.html#cb703-9"></a>                 <span class="dt">port =</span> <span class="dv">5432</span>,</span>
<span id="cb703-10"><a href="programming.html#cb703-10"></a>                 <span class="dt">dbname =</span> <span class="st">&quot;mjvgsdzg&quot;</span>)</span>
<span id="cb703-11"><a href="programming.html#cb703-11"></a>}</span>
<span id="cb703-12"><a href="programming.html#cb703-12"></a></span>
<span id="cb703-13"><a href="programming.html#cb703-13"></a></span>
<span id="cb703-14"><a href="programming.html#cb703-14"></a><span class="co"># A function to open a database connection, read and return data:</span></span>
<span id="cb703-15"><a href="programming.html#cb703-15"></a>read_my_data &lt;-<span class="st"> </span><span class="cf">function</span>(tablename, ...){</span>
<span id="cb703-16"><a href="programming.html#cb703-16"></a>  </span>
<span id="cb703-17"><a href="programming.html#cb703-17"></a>  con &lt;-<span class="st"> </span><span class="kw">db_connection</span>()</span>
<span id="cb703-18"><a href="programming.html#cb703-18"></a>  <span class="kw">on.exit</span>(<span class="kw">dbDisconnect</span>(con))</span>
<span id="cb703-19"><a href="programming.html#cb703-19"></a>  </span>
<span id="cb703-20"><a href="programming.html#cb703-20"></a>  data &lt;-<span class="st"> </span><span class="kw">dbReadTable</span>(con, tablename, ...)</span>
<span id="cb703-21"><a href="programming.html#cb703-21"></a>  </span>
<span id="cb703-22"><a href="programming.html#cb703-22"></a>}</span></code></pre></div>
<p>With the above <code>read_my_data</code> you can read your favorite table from a database, simply with <code>mydata &lt;- read_my_data("cooldatatable")</code>. However, this is a poor function if you are planning to read many tables from this database in a short time, then it makes sense to keep the connection open the entire time (especially for remote databases, as is common).</p>
<p>The following improvement allows passing a connection object, or creating it if it was not passed as an argument:</p>
<div class="sourceCode" id="cb704"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb704-1"><a href="programming.html#cb704-1"></a>read_my_data2 &lt;-<span class="st"> </span><span class="cf">function</span>(tablename, <span class="dt">con =</span> <span class="ot">NULL</span>, ...){</span>
<span id="cb704-2"><a href="programming.html#cb704-2"></a>  </span>
<span id="cb704-3"><a href="programming.html#cb704-3"></a>  <span class="cf">if</span>(<span class="kw">missing</span>(con)){</span>
<span id="cb704-4"><a href="programming.html#cb704-4"></a>    con &lt;-<span class="st"> </span><span class="kw">db_connection</span>()</span>
<span id="cb704-5"><a href="programming.html#cb704-5"></a>    <span class="kw">on.exit</span>(<span class="kw">dbDisconnect</span>(con))</span>
<span id="cb704-6"><a href="programming.html#cb704-6"></a>  }</span>
<span id="cb704-7"><a href="programming.html#cb704-7"></a>  </span>
<span id="cb704-8"><a href="programming.html#cb704-8"></a>  data &lt;-<span class="st"> </span><span class="kw">dbReadTable</span>(con, tablename, ...)</span>
<span id="cb704-9"><a href="programming.html#cb704-9"></a>  </span>
<span id="cb704-10"><a href="programming.html#cb704-10"></a>}</span></code></pre></div>
<p>Now we can do,</p>
<div class="sourceCode" id="cb705"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb705-1"><a href="programming.html#cb705-1"></a>my_con &lt;-<span class="st"> </span><span class="kw">db_connection</span>()</span>
<span id="cb705-2"><a href="programming.html#cb705-2"></a></span>
<span id="cb705-3"><a href="programming.html#cb705-3"></a>flowers &lt;-<span class="st"> </span><span class="kw">read_my_data2</span>(<span class="st">&quot;flower&quot;</span>, <span class="dt">con =</span> my_con)</span>
<span id="cb705-4"><a href="programming.html#cb705-4"></a>eggs &lt;-<span class="st"> </span><span class="kw">read_my_data2</span>(<span class="st">&quot;eggs&quot;</span>, <span class="dt">con =</span> my_con)</span>
<span id="cb705-5"><a href="programming.html#cb705-5"></a>butter &lt;-<span class="st"> </span><span class="kw">read_my_data2</span>(<span class="st">&quot;butter&quot;</span>, <span class="dt">con =</span> my_con)</span>
<span id="cb705-6"><a href="programming.html#cb705-6"></a>milk &lt;-<span class="st"> </span><span class="kw">read_my_data2</span>(<span class="st">&quot;milk&quot;</span>, <span class="dt">con =</span> my_con)</span>
<span id="cb705-7"><a href="programming.html#cb705-7"></a></span>
<span id="cb705-8"><a href="programming.html#cb705-8"></a><span class="kw">dbDisconnect</span>(my_con)</span></code></pre></div>
<p>If we leave out the <code>con</code> argument, the connection will be opened and closed for you every time you call <code>read_my_data2</code>.</p>
</div>
</div>
<div id="exercises-3" class="section level2">
<h2><span class="header-section-number">4.7</span> Exercises</h2>
<div id="writing-functions" class="section level3">
<h3><span class="header-section-number">4.7.1</span> Writing functions</h3>
<ol style="list-style-type: decimal">
<li><p>Write a function that adds two numbers, and divides the result by 2.</p></li>
<li><p>You learned in Section <a href="dataskills1.html#workingtext">2.7.4</a> that you can take subset of a string using the <code>substr</code> function. First, using that function to extract the first 2 characters of a bit of text. Then, write a function called <code>firstTwoChars</code> that extracts the first two characters of any bit of text.</p></li>
<li><p>Write a function that checks if there are any missing values in a vector (using <code>is.na</code> and <code>any</code>). The function should return <code>TRUE</code> if there are missing values, and <code>FALSE</code> if not.</p></li>
<li><p>Improve the function so that it tells you which of the values are missing, if any (<em>Hint:</em>use the <code>which</code> function). You can use <code>message</code> to write messages to the console.</p></li>
<li><p>The function <code>readline</code> can be used to ask for data to be typed in. First, figure out how to use <code>readline</code> by reading the corresponding help file. Then, construct a function called <code>getAge</code> that asks the user to type his/her age. (<em>Hint:</em> check the examples in the <code>readline</code> help page).</p></li>
<li><p><strong>hard</strong> Recall the functions <code>head</code> and <code>tail</code>. Write a function called <code>middle</code> that shows a few rows around (approx.) the ‘middle’ of the dataset. <em>Hint:</em> use <code>nrow</code>, <code>print</code>, and possibly <code>floor</code>.</p></li>
</ol>
</div>
<div id="working-with-lists" class="section level3">
<h3><span class="header-section-number">4.7.2</span> Working with lists</h3>
<p>First read the following list:</p>
<pre><code>veclist &lt;- list(x=1:5, y=2:6, z=3:7)</code></pre>
<ol style="list-style-type: decimal">
<li><p>Using <code>sapply</code>, check that all elements of the list are vectors of the same length. Also calculate the sum of each element.</p></li>
<li><p>Add an element to the list called ‘norms’ that is a vector of 10 numbers drawn from the standard normal distribution.</p></li>
<li><p>Using the <code>pupae</code> data, use a <span class="math inline">\(t\)</span>-test to find if PupalWeight varies with temperature treatment, separate for the two CO<span class="math inline">\(_2\)</span> treatments (so, do two <span class="math inline">\(t\)</span>-tests). You <strong>must</strong> use <code>split</code> and <code>lapply</code>.</p></li>
<li><p>For this exercise use the <code>coweeta</code> data - a dataset with measurements of tree size. Split the data by <code>species</code>, to produce a list called <code>coweeta_sp</code>. Keep only those species that have at least 10 observations. (<em>Hint:</em> first count the number of observations per species, save that as a vector, find which are at least 10, and use that to subscript the list.) If you don’t know how to do this last step, skip it and continue to the next item.</p></li>
<li><p>Using the split Coweeta data, perform a linear regression of <code>log10(biomass)</code> on <code>log10(height)</code>, separately by species. Use <code>lapply</code>.</p></li>
</ol>
</div>
<div id="functions-for-histograms" class="section level3">
<h3><span class="header-section-number">4.7.3</span> Functions for histograms</h3>
<p>First run this code to produce two vectors.</p>
<pre><code>x &lt;- rnorm(100)
y &lt;- x + rnorm(100)</code></pre>
<ol style="list-style-type: decimal">
<li><p>Run a linear regression y = f(x), save the resulting object. Look at the structure of this object, and note the names of the elements. Extract the residuals and make a histogram.</p></li>
<li><p><strong>Hard</strong>. From the previous question, write a function that takes an <code>lm</code> object as an argument, and plots a histogram of the residuals.</p></li>
</ol>
</div>
<div id="using-functions-to-make-many-plots" class="section level3">
<h3><span class="header-section-number">4.7.4</span> Using functions to make many plots</h3>
<ol style="list-style-type: decimal">
<li><p>Read the cereals data. Create a subset of data where the <code>Manufacturer</code> has at least two observations (use <code>table</code> to find out which you want to keep first). Don’t forget to drop the empty factor level you may have created!</p></li>
<li><p>Make a single PDF with six plots, with a scatter plot between potassium and fiber for each of the six (or seven?) Manufacturers. (<em>Hint:</em> ook at the template for producing a PDF with multiple pages at the bottom of Section <a href="programming.html#simpleloops">4.4</a>.</p></li>
</ol>
</div>
<div id="monthly-weather-plots" class="section level3">
<h3><span class="header-section-number">4.7.5</span> Monthly weather plots</h3>
<ol style="list-style-type: decimal">
<li><p>For the HFE weather dataset (<code>hfemet2008</code>) that makes a scatter plot between PAR (a measure of light intensity) and VPD (a measure of the dryness of air).</p></li>
<li><p>Then, split the dataset by month (recall Section <a href="programming.html#dfrlists">4.3.5</a>), and make twelve such scatter plots. Save the result in a single PDF, or on one page with 12 small figures.</p></li>
</ol>
<!-- ### The Central limit theorem -->
<!-- The 'central limit theorem' (CLT) forms the backbone of inferential statistics. This theorem states (informally) that if you draw samples (of *n* units) from a population, the mean of these samples follows a normal distribution. This is true regardless of the underlying distribution you sample from.  -->
<!-- In this exercise, you will apply a simple simulation study to test the CLT, and to make histograms and quantile-quantile plots.  -->
<!-- 1. Draw 200 samples of size 10 from a uniform distribution. Use the `runif` function to sample from the uniform distribution, and the `replicate` function to repeat this many times. -->
<!-- ```{r } -->
<!-- unisamples <- replicate(200, runif(10)) -->
<!-- ``` -->
<!-- 1.  Compute the sample mean for each of the 200 samples in~\ref{ite:draw200}. Use `apply` or `colMeans` to calculate column-wise means of a matrix (note: `replicate` will return a matrix, if used correctly). -->
<!-- ```{r } -->
<!-- colMeans(unisamples) -->
<!-- ``` -->
<!-- 1.  Draw a histogram of the 200 sample means, using `hist`. Also draw a normal quantile-quantile plot, using `qqnorm`.  -->
<!-- ```{r } -->
<!-- hist(colMeans(unisamples)) -->
<!-- qqnorm(colMeans(unisamples)) -->
<!-- ``` -->
<!-- 1.  On the histogram, add a normal curve using the `dnorm` function. Note: to do this, plot the histogram with the argument `freq=FALSE`, so that the histogram draws the probability density, not the frequency.  -->
<!-- ```{r } -->
<!-- X <- colMeans(unisamples) -->
<!-- hist(X, freq=FALSE) -->
<!-- curve(dnorm(x, mean=mean(X), sd=sd(X)), add=T) -->
<!-- ``` -->
<!-- \item \hard Write a function that does all of the above, and call it `PlotCLT`. -->
<!-- ```{r } -->
<!-- plotCLT <- function(n1=200, n2=10){ -->
<!--   unisamples <- replicate(n1, runif(n2)) -->
<!--   X <- colMeans(unisamples) -->
<!--   hist(X, freq=FALSE) -->
<!--   curve(dnorm(x, mean=mean(X), sd=sd(X)), add=T) -->
<!-- } -->
<!-- ``` -->

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="dataskills2.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="webservices.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["twitter", "linkedin"],
"google": false
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["prcr.pdf"],
"toc": {
"collapse": "subsection"
},
"favicon": "favicon.ico",
"githubrepo": "RemkoDuursma/prcr",
"description": "A Learning Guide to R: : data, analytical, and programming skills"
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
